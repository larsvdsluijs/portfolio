"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[694],{7694:(mg,Yo,Hn)=>{Hn.d(Yo,{f:()=>lw});var N=Hn(467);const cn=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=63&s|128):55296==(64512&s)&&n+1<r.length&&56320==(64512&r.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&r.charCodeAt(++n)),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=63&s|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=63&s|128)}return e},ln={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],o=s+1<r.length,u=o?r[s+1]:0,c=s+2<r.length,h=c?r[s+2]:0;let _=(15&u)<<2|h>>6,T=63&h;c||(T=64,o||(_=64)),n.push(t[i>>2],t[(3&i)<<4|u>>4],t[_],t[T])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(cn(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):function(r){const e=[];let t=0,n=0;for(;t<r.length;){const s=r[t++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[t++];e[n++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const c=((7&s)<<18|(63&r[t++])<<12|(63&r[t++])<<6|63&r[t++])-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(1023&c))}else{const i=r[t++],o=r[t++];e[n++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=t[r.charAt(s++)],u=s<r.length?t[r.charAt(s)]:0;++s;const h=s<r.length?t[r.charAt(s)]:64;++s;const p=s<r.length?t[r.charAt(s)]:64;if(++s,null==i||null==u||null==h||null==p)throw new hn;n.push(i<<2|u>>4),64!==h&&(n.push(u<<4&240|h>>2),64!==p&&n.push(h<<6&192|p))}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class hn extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const tt=function(r){return function(r){const e=cn(r);return ln.encodeByteArray(e,!0)}(r).replace(/\./g,"")};const mi=()=>{try{return function Bl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const r=process.env.__FIREBASE_DEFAULTS__;return r?JSON.parse(r):void 0})()||(()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&function(r){try{return ln.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(r[1]);return e&&JSON.parse(e)})()}catch(r){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`)}},ql=r=>{const e=(r=>mi()?.emulatorHosts?.[r])(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),n]:[e.substring(0,t),n]},jl=()=>mi()?.config;class Gl{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function _i(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}function zl(r){return ea.apply(this,arguments)}function ea(){return(ea=(0,N.A)(function*(r){return(yield fetch(r,{credentials:"include"})).ok})).apply(this,arguments)}function $l(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...r};return[tt(JSON.stringify({alg:"none",type:"JWT"})),tt(JSON.stringify(o)),""].join(".")}const Xr={};let Kl=!1;function Hl(r,e){if(typeof window>"u"||typeof document>"u"||!_i(window.location.host)||Xr[r]===e||Xr[r]||Kl)return;function t(_){return`__firebase__banner__${_}`}Xr[r]=e;const n="__firebase__banner",i=function Eg(){const r={prod:[],emulator:[]};for(const e of Object.keys(Xr))Xr[e]?r.emulator.push(e):r.prod.push(e);return r}().prod.length>0;function p(){const _=function Ag(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}(n),T=t("text"),R=document.getElementById(T)||document.createElement("span"),x=t("learnmore"),C=document.getElementById(x)||document.createElement("a"),U=t("preprendIcon"),q=document.getElementById(U)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const F=_.element;(function u(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"})(F),function f(_,T){_.setAttribute("id",T),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}(C,x);const z=function h(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{Kl=!0,function o(){const _=document.getElementById(n);_&&_.remove()}()},_}();(function c(_,T){_.setAttribute("width","24"),_.setAttribute("id",T),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"})(q,U),F.append(q,R,C,z),document.body.appendChild(F)}i?(R.innerText="Preview backend disconnected.",q.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(q.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',R.innerText="Preview backend running in this workspace."),R.setAttribute("id",T)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",p):p()}function Ql(){return!function Wl(){const r=mi()?.forceEnvironment;if("node"===r)return!0;if("browser"===r)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class fn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,fn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Yl.prototype.create)}}class Yl{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?function Rg(r,e){return r.replace(Sg,(t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`})}(i,n):"Error";return new fn(s,`${this.serviceName}: ${o} (${s}).`,n)}}const Sg=/\{\$([^}]+)}/g;function Xn(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const s of t){if(!n.includes(s))return!1;const i=r[s],o=e[s];if(eh(i)&&eh(o)){if(!Xn(i,o))return!1}else if(i!==o)return!1}for(const s of n)if(!t.includes(s))return!1;return!0}function eh(r){return null!==r&&"object"==typeof r}function $e(r){return r&&r._delegate?r._delegate:r}class Jn{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const pn="[DEFAULT]";class Og{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Gl;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(n)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function Fg(r){return"EAGER"===r.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:pn})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(e=pn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return(0,N.A)(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...t.filter(n=>"_delete"in n).map(n=>n._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=pn){return this.instances.has(e)}getOptions(e=pn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(i)&&o.resolve(s);return s}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(n)??new Set;s.add(e),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&e(i,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===pn?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=pn){return this.component?this.component.multipleInstances?e:pn:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Lg{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Og(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const ra=[];var Y=function(r){return r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT",r}(Y||{});const th={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},Ug=Y.INFO,Bg={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},qg=(r,e,...t)=>{if(e<r.logLevel)return;const n=(new Date).toISOString(),s=Bg[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${n}]  ${r.name}:`,...t)};class nh{constructor(e){this.name=e,this._logLevel=Ug,this._logHandler=qg,this._userLogHandler=null,ra.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Y))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?th[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...e),this._logHandler(this,Y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...e),this._logHandler(this,Y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...e),this._logHandler(this,Y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...e),this._logHandler(this,Y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...e),this._logHandler(this,Y.ERROR,...e)}}const jg=(r,e)=>e.some(t=>r instanceof t);let rh,sh;const ih=new WeakMap,sa=new WeakMap,oh=new WeakMap,ia=new WeakMap,oa=new WeakMap;let aa={get(r,e,t){if(r instanceof IDBTransaction){if("done"===e)return sa.get(r);if("objectStoreNames"===e)return r.objectStoreNames||oh.get(r);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return kt(r[e])},set:(r,e,t)=>(r[e]=t,!0),has:(r,e)=>r instanceof IDBTransaction&&("done"===e||"store"===e)||e in r};function Qg(r){return"function"==typeof r?function Wg(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function zg(){return sh||(sh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(r)?function(...e){return r.apply(ua(this),e),kt(ih.get(this))}:function(...e){return kt(r.apply(ua(this),e))}:function(e,...t){const n=r.call(ua(this),e,...t);return oh.set(n,e.sort?e.sort():[e]),kt(n)}}(r):(r instanceof IDBTransaction&&function Kg(r){if(sa.has(r))return;const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",o),r.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",o),r.addEventListener("abort",o)});sa.set(r,e)}(r),jg(r,function Gg(){return rh||(rh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(r,aa):r)}function kt(r){if(r instanceof IDBRequest)return function $g(r){const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",o)},i=()=>{t(kt(r.result)),s()},o=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ih.set(t,r)}).catch(()=>{}),oa.set(e,r),e}(r);if(ia.has(r))return ia.get(r);const e=Qg(r);return e!==r&&(ia.set(r,e),oa.set(e,r)),e}const ua=r=>oa.get(r),Jg=["get","getKey","getAll","getAllKeys","count"],Yg=["put","add","delete","clear"],ca=new Map;function ah(r,e){if(!(r instanceof IDBDatabase)||e in r||"string"!=typeof e)return;if(ca.get(e))return ca.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=Yg.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!Jg.includes(t))return;const i=function(){var o=(0,N.A)(function*(u,...c){const h=this.transaction(u,s?"readwrite":"readonly");let f=h.store;return n&&(f=f.index(c.shift())),(yield Promise.all([f[t](...c),s&&h.done]))[0]});return function(c){return o.apply(this,arguments)}}();return ca.set(e,i),i}!function Hg(r){aa=r(aa)}(r=>({...r,get:(e,t,n)=>ah(e,t)||r.get(e,t,n),has:(e,t)=>!!ah(e,t)||r.has(e,t)}));class Zg{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function ey(r){return"VERSION"===r.getComponent()?.type}(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}return null}).filter(t=>t).join(" ")}}const yi="@firebase/app",yt=new nh("@firebase/app"),ty="@firebase/app-compat",ny="@firebase/analytics-compat",ry="@firebase/analytics",sy="@firebase/app-check-compat",iy="@firebase/app-check",oy="@firebase/auth",ay="@firebase/auth-compat",uy="@firebase/database",cy="@firebase/data-connect",ly="@firebase/database-compat",hy="@firebase/functions",dy="@firebase/functions-compat",fy="@firebase/installations",py="@firebase/installations-compat",my="@firebase/messaging",_y="@firebase/messaging-compat",gy="@firebase/performance",yy="@firebase/performance-compat",Iy="@firebase/remote-config",Ty="@firebase/remote-config-compat",Ey="@firebase/storage",Ay="@firebase/storage-compat",vy="@firebase/firestore",wy="@firebase/ai",by="@firebase/firestore-compat",Ry="firebase",Ii="[DEFAULT]",Py={[yi]:"fire-core",[ty]:"fire-core-compat",[ry]:"fire-analytics",[ny]:"fire-analytics-compat",[iy]:"fire-app-check",[sy]:"fire-app-check-compat",[oy]:"fire-auth",[ay]:"fire-auth-compat",[uy]:"fire-rtdb",[cy]:"fire-data-connect",[ly]:"fire-rtdb-compat",[hy]:"fire-fn",[dy]:"fire-fn-compat",[fy]:"fire-iid",[py]:"fire-iid-compat",[my]:"fire-fcm",[_y]:"fire-fcm-compat",[gy]:"fire-perf",[yy]:"fire-perf-compat",[Iy]:"fire-rc",[Ty]:"fire-rc-compat",[Ey]:"fire-gcs",[Ay]:"fire-gcs-compat",[vy]:"fire-fst",[by]:"fire-fst-compat",[wy]:"fire-vertex","fire-js":"fire-js",[Ry]:"fire-js-all"},mn=new Map,Jr=new Map,Yr=new Map;function uh(r,e){try{r.container.addComponent(e)}catch(t){yt.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Zr(r){const e=r.name;if(Yr.has(e))return yt.debug(`There were multiple attempts to register component ${e}.`),!1;Yr.set(e,r);for(const t of mn.values())uh(t,r);for(const t of Jr.values())uh(t,r);return!0}function ha(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function lh(r){return null!=r&&void 0!==r.settings}const Ke=new Yl("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class hh{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Jn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ke.create("app-deleted",{appName:this._name})}}function ph(r,e={}){let t=r;"object"!=typeof e&&(e={name:e});const n={name:Ii,automaticDataCollectionEnabled:!0,...e},s=n.name;if("string"!=typeof s||!s)throw Ke.create("bad-app-name",{appName:String(s)});if(t||(t=jl()),!t)throw Ke.create("no-options");const i=mn.get(s);if(i){if(Xn(t,i.options)&&Xn(n,i.config))return i;throw Ke.create("duplicate-app",{appName:s})}const o=new Lg(s);for(const c of Yr.values())o.addComponent(c);const u=new hh(t,n,o);return mn.set(s,u),u}function mh(r=Ii){const e=mn.get(r);if(!e&&r===Ii&&jl())return ph();if(!e)throw Ke.create("no-app",{appName:r});return e}function It(r,e,t){let n=Py[r]??r;t&&(n+=`-${t}`);const s=n.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${n}" with version "${e}":`];return s&&o.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void yt.warn(o.join(" "))}Zr(new Jn(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}const Ny="firebase-heartbeat-database",ky=1,es="firebase-heartbeat-store";let fa=null;function _h(){return fa||(fa=function Xg(r,e,{blocked:t,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(r,e),u=kt(o);return n&&o.addEventListener("upgradeneeded",c=>{n(kt(o.result),c.oldVersion,c.newVersion,kt(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),u.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}(Ny,ky,{upgrade:(r,e)=>{if(0===e)try{r.createObjectStore(es)}catch(t){console.warn(t)}}}).catch(r=>{throw Ke.create("idb-open",{originalErrorMessage:r.message})})),fa}function pa(){return(pa=(0,N.A)(function*(r){try{const t=(yield _h()).transaction(es),n=yield t.objectStore(es).get(yh(r));return yield t.done,n}catch(e){if(e instanceof fn)yt.warn(e.message);else{const t=Ke.create("idb-get",{originalErrorMessage:e?.message});yt.warn(t.message)}}})).apply(this,arguments)}function gh(r,e){return ma.apply(this,arguments)}function ma(){return(ma=(0,N.A)(function*(r,e){try{const n=(yield _h()).transaction(es,"readwrite");yield n.objectStore(es).put(e,yh(r)),yield n.done}catch(t){if(t instanceof fn)yt.warn(t.message);else{const n=Ke.create("idb-set",{originalErrorMessage:t?.message});yt.warn(n.message)}}})).apply(this,arguments)}function yh(r){return`${r.name}!${r.options.appId}`}class Ly{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new By(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}triggerHeartbeat(){var e=this;return(0,N.A)(function*(){try{const n=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ih();if(null==e._heartbeatsCache?.heartbeats&&(e._heartbeatsCache=yield e._heartbeatsCachePromise,null==e._heartbeatsCache?.heartbeats)||e._heartbeatsCache.lastSentHeartbeatDate===s||e._heartbeatsCache.heartbeats.some(i=>i.date===s))return;if(e._heartbeatsCache.heartbeats.push({date:s,agent:n}),e._heartbeatsCache.heartbeats.length>30){const i=function qy(r){if(0===r.length)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}(e._heartbeatsCache.heartbeats);e._heartbeatsCache.heartbeats.splice(i,1)}return e._storage.overwrite(e._heartbeatsCache)}catch(t){yt.warn(t)}})()}getHeartbeatsHeader(){var e=this;return(0,N.A)(function*(){try{if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null==e._heartbeatsCache?.heartbeats||0===e._heartbeatsCache.heartbeats.length)return"";const t=Ih(),{heartbeatsToSend:n,unsentEntries:s}=function Uy(r,e=1024){const t=[];let n=r.slice();for(const s of r){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Th(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Th(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}(e._heartbeatsCache.heartbeats),i=tt(JSON.stringify({version:2,heartbeats:n}));return e._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(e._heartbeatsCache.heartbeats=s,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),i}catch(t){return yt.warn(t),""}})()}}function Ih(){return(new Date).toISOString().substring(0,10)}class By{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,N.A)(function*(){return!!function Jl(){try{return"object"==typeof indexedDB}catch{return!1}}()&&function wg(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return(0,N.A)(function*(){if(yield e._canUseIndexedDBPromise){const n=yield function Oy(r){return pa.apply(this,arguments)}(e.app);return n?.heartbeats?n:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(e){var t=this;return(0,N.A)(function*(){if(yield t._canUseIndexedDBPromise){const s=yield t.read();return gh(t.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return(0,N.A)(function*(){if(yield t._canUseIndexedDBPromise){const s=yield t.read();return gh(t.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function Th(r){return tt(JSON.stringify({version:2,heartbeats:r})).length}!function jy(r){Zr(new Jn("platform-logger",e=>new Zg(e),"PRIVATE")),Zr(new Jn("heartbeat",e=>new Ly(e),"PRIVATE")),It(yi,"0.14.0",r),It(yi,"0.14.0","esm2020"),It("fire-js","")}(""),It("firebase","12.0.0","app");var Ot,vh,Eh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ah={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function s(E,g,y){y||(y=0);var A=Array(16);if("string"==typeof g)for(var v=0;16>v;++v)A[v]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(v=0;16>v;++v)A[v]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;var P=E.g[3],I=(g=E.g[0])+(P^(y=E.g[1])&((v=E.g[2])^P))+A[0]+3614090360&4294967295;I=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=(y=(v=(P=(g=y+(I<<7&4294967295|I>>>25))+((I=P+(v^g&(y^v))+A[1]+3905402710&4294967295)<<12&4294967295|I>>>20))+((I=v+(y^P&(g^y))+A[2]+606105819&4294967295)<<17&4294967295|I>>>15))+((I=y+(g^v&(P^g))+A[3]+3250441966&4294967295)<<22&4294967295|I>>>10))+((I=g+(P^y&(v^P))+A[4]+4118548399&4294967295)<<7&4294967295|I>>>25))+((I=P+(v^g&(y^v))+A[5]+1200080426&4294967295)<<12&4294967295|I>>>20))+((I=v+(y^P&(g^y))+A[6]+2821735955&4294967295)<<17&4294967295|I>>>15))+((I=y+(g^v&(P^g))+A[7]+4249261313&4294967295)<<22&4294967295|I>>>10))+((I=g+(P^y&(v^P))+A[8]+1770035416&4294967295)<<7&4294967295|I>>>25))+((I=P+(v^g&(y^v))+A[9]+2336552879&4294967295)<<12&4294967295|I>>>20))+((I=v+(y^P&(g^y))+A[10]+4294925233&4294967295)<<17&4294967295|I>>>15))+((I=y+(g^v&(P^g))+A[11]+2304563134&4294967295)<<22&4294967295|I>>>10))+((I=g+(P^y&(v^P))+A[12]+1804603682&4294967295)<<7&4294967295|I>>>25))+((I=P+(v^g&(y^v))+A[13]+4254626195&4294967295)<<12&4294967295|I>>>20))+((I=v+(y^P&(g^y))+A[14]+2792965006&4294967295)<<17&4294967295|I>>>15))+((I=y+(g^v&(P^g))+A[15]+1236535329&4294967295)<<22&4294967295|I>>>10))+((I=g+(v^P&(y^v))+A[1]+4129170786&4294967295)<<5&4294967295|I>>>27))+((I=P+(y^v&(g^y))+A[6]+3225465664&4294967295)<<9&4294967295|I>>>23))+((I=v+(g^y&(P^g))+A[11]+643717713&4294967295)<<14&4294967295|I>>>18))+((I=y+(P^g&(v^P))+A[0]+3921069994&4294967295)<<20&4294967295|I>>>12))+((I=g+(v^P&(y^v))+A[5]+3593408605&4294967295)<<5&4294967295|I>>>27))+((I=P+(y^v&(g^y))+A[10]+38016083&4294967295)<<9&4294967295|I>>>23))+((I=v+(g^y&(P^g))+A[15]+3634488961&4294967295)<<14&4294967295|I>>>18))+((I=y+(P^g&(v^P))+A[4]+3889429448&4294967295)<<20&4294967295|I>>>12))+((I=g+(v^P&(y^v))+A[9]+568446438&4294967295)<<5&4294967295|I>>>27))+((I=P+(y^v&(g^y))+A[14]+3275163606&4294967295)<<9&4294967295|I>>>23))+((I=v+(g^y&(P^g))+A[3]+4107603335&4294967295)<<14&4294967295|I>>>18))+((I=y+(P^g&(v^P))+A[8]+1163531501&4294967295)<<20&4294967295|I>>>12))+((I=g+(v^P&(y^v))+A[13]+2850285829&4294967295)<<5&4294967295|I>>>27))+((I=P+(y^v&(g^y))+A[2]+4243563512&4294967295)<<9&4294967295|I>>>23))+((I=v+(g^y&(P^g))+A[7]+1735328473&4294967295)<<14&4294967295|I>>>18))+((I=y+(P^g&(v^P))+A[12]+2368359562&4294967295)<<20&4294967295|I>>>12))+((I=g+(y^v^P)+A[5]+4294588738&4294967295)<<4&4294967295|I>>>28))+((I=P+(g^y^v)+A[8]+2272392833&4294967295)<<11&4294967295|I>>>21))+((I=v+(P^g^y)+A[11]+1839030562&4294967295)<<16&4294967295|I>>>16))+((I=y+(v^P^g)+A[14]+4259657740&4294967295)<<23&4294967295|I>>>9))+((I=g+(y^v^P)+A[1]+2763975236&4294967295)<<4&4294967295|I>>>28))+((I=P+(g^y^v)+A[4]+1272893353&4294967295)<<11&4294967295|I>>>21))+((I=v+(P^g^y)+A[7]+4139469664&4294967295)<<16&4294967295|I>>>16))+((I=y+(v^P^g)+A[10]+3200236656&4294967295)<<23&4294967295|I>>>9))+((I=g+(y^v^P)+A[13]+681279174&4294967295)<<4&4294967295|I>>>28))+((I=P+(g^y^v)+A[0]+3936430074&4294967295)<<11&4294967295|I>>>21))+((I=v+(P^g^y)+A[3]+3572445317&4294967295)<<16&4294967295|I>>>16))+((I=y+(v^P^g)+A[6]+76029189&4294967295)<<23&4294967295|I>>>9))+((I=g+(y^v^P)+A[9]+3654602809&4294967295)<<4&4294967295|I>>>28))+((I=P+(g^y^v)+A[12]+3873151461&4294967295)<<11&4294967295|I>>>21))+((I=v+(P^g^y)+A[15]+530742520&4294967295)<<16&4294967295|I>>>16))+((I=y+(v^P^g)+A[2]+3299628645&4294967295)<<23&4294967295|I>>>9))+((I=g+(v^(y|~P))+A[0]+4096336452&4294967295)<<6&4294967295|I>>>26))+((I=P+(y^(g|~v))+A[7]+1126891415&4294967295)<<10&4294967295|I>>>22))+((I=v+(g^(P|~y))+A[14]+2878612391&4294967295)<<15&4294967295|I>>>17))+((I=y+(P^(v|~g))+A[5]+4237533241&4294967295)<<21&4294967295|I>>>11))+((I=g+(v^(y|~P))+A[12]+1700485571&4294967295)<<6&4294967295|I>>>26))+((I=P+(y^(g|~v))+A[3]+2399980690&4294967295)<<10&4294967295|I>>>22))+((I=v+(g^(P|~y))+A[10]+4293915773&4294967295)<<15&4294967295|I>>>17))+((I=y+(P^(v|~g))+A[1]+2240044497&4294967295)<<21&4294967295|I>>>11))+((I=g+(v^(y|~P))+A[8]+1873313359&4294967295)<<6&4294967295|I>>>26))+((I=P+(y^(g|~v))+A[15]+4264355552&4294967295)<<10&4294967295|I>>>22))+((I=v+(g^(P|~y))+A[6]+2734768916&4294967295)<<15&4294967295|I>>>17))+((I=y+(P^(v|~g))+A[13]+1309151649&4294967295)<<21&4294967295|I>>>11))+((P=(g=y+((I=g+(v^(y|~P))+A[4]+4149444226&4294967295)<<6&4294967295|I>>>26))+((I=P+(y^(g|~v))+A[11]+3174756917&4294967295)<<10&4294967295|I>>>22))^((v=P+((I=v+(g^(P|~y))+A[2]+718787259&4294967295)<<15&4294967295|I>>>17))|~g))+A[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(v+(I<<21&4294967295|I>>>11))&4294967295,E.g[2]=E.g[2]+v&4294967295,E.g[3]=E.g[3]+P&4294967295}function o(E,g){this.h=g;for(var y=[],A=!0,v=E.length-1;0<=v;v--){var P=0|E[v];A&&P==g||(y[v]=P,A=!1)}this.g=y}(function e(E,g){function y(){}y.prototype=g.prototype,E.D=g.prototype,E.prototype=new y,E.prototype.constructor=E,E.C=function(A,v,P){for(var I=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)I[Ct-2]=arguments[Ct];return g.prototype[v].apply(A,I)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(E,g){void 0===g&&(g=E.length);for(var y=g-this.blockSize,A=this.B,v=this.h,P=0;P<g;){if(0==v)for(;P<=y;)s(this,E,P),P+=this.blockSize;if("string"==typeof E){for(;P<g;)if(A[v++]=E.charCodeAt(P++),v==this.blockSize){s(this,A),v=0;break}}else for(;P<g;)if(A[v++]=E[P++],v==this.blockSize){s(this,A),v=0;break}}this.h=v,this.o+=g},n.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;var y=8*this.o;for(g=E.length-8;g<E.length;++g)E[g]=255&y,y/=256;for(this.u(E),E=Array(16),g=y=0;4>g;++g)for(var A=0;32>A;A+=8)E[y++]=this.g[g]>>>A&255;return E};var u={};function c(E){return-128<=E&&128>E?function i(E,g){var y=u;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=g(E)}(E,function(g){return new o([0|g],0>g?-1:0)}):new o([0|E],0>E?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return p;if(0>E)return C(h(-E));for(var g=[],y=1,A=0;E>=y;A++)g[A]=E/y|0,y*=4294967296;return new o(g,0)}var p=c(0),_=c(1),T=c(16777216);function R(E){if(0!=E.h)return!1;for(var g=0;g<E.g.length;g++)if(0!=E.g[g])return!1;return!0}function x(E){return-1==E.h}function C(E){for(var g=E.g.length,y=[],A=0;A<g;A++)y[A]=~E.g[A];return new o(y,~E.h).add(_)}function U(E,g){return E.add(C(g))}function q(E,g){for(;(65535&E[g])!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function F(E,g){this.g=E,this.h=g}function z(E,g){if(R(g))throw Error("division by zero");if(R(E))return new F(p,p);if(x(E))return g=z(C(E),g),new F(C(g.g),C(g.h));if(x(g))return g=z(E,C(g)),new F(C(g.g),g.h);if(30<E.g.length){if(x(E)||x(g))throw Error("slowDivide_ only works with positive integers.");for(var y=_,A=g;0>=A.l(E);)y=X(y),A=X(A);var v=W(y,1),P=W(A,1);for(A=W(A,2),y=W(y,2);!R(A);){var I=P.add(A);0>=I.l(E)&&(v=v.add(y),P=I),A=W(A,1),y=W(y,1)}return g=U(E,v.j(g)),new F(v,g)}for(v=p;0<=E.l(g);){for(y=Math.max(1,Math.floor(E.m()/g.m())),A=48>=(A=Math.ceil(Math.log(y)/Math.LN2))?1:Math.pow(2,A-48),I=(P=h(y)).j(g);x(I)||0<I.l(E);)I=(P=h(y-=A)).j(g);R(P)&&(P=_),v=v.add(P),E=U(E,I)}return new F(v,E)}function X(E){for(var g=E.g.length+1,y=[],A=0;A<g;A++)y[A]=E.i(A)<<1|E.i(A-1)>>>31;return new o(y,E.h)}function W(E,g){var y=g>>5;g%=32;for(var A=E.g.length-y,v=[],P=0;P<A;P++)v[P]=0<g?E.i(P+y)>>>g|E.i(P+y+1)<<32-g:E.i(P+y);return new o(v,E.h)}(r=o.prototype).m=function(){if(x(this))return-C(this).m();for(var E=0,g=1,y=0;y<this.g.length;y++){var A=this.i(y);E+=(0<=A?A:4294967296+A)*g,g*=4294967296}return E},r.toString=function(E){if(2>(E=E||10)||36<E)throw Error("radix out of range: "+E);if(R(this))return"0";if(x(this))return"-"+C(this).toString(E);for(var g=h(Math.pow(E,6)),y=this,A="";;){var v=z(y,g).g,P=((0<(y=U(y,v.j(g))).g.length?y.g[0]:y.h)>>>0).toString(E);if(R(y=v))return P+A;for(;6>P.length;)P="0"+P;A=P+A}},r.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h},r.l=function(E){return x(E=U(this,E))?-1:R(E)?0:1},r.abs=function(){return x(this)?C(this):this},r.add=function(E){for(var g=Math.max(this.g.length,E.g.length),y=[],A=0,v=0;v<=g;v++){var P=A+(65535&this.i(v))+(65535&E.i(v)),I=(P>>>16)+(this.i(v)>>>16)+(E.i(v)>>>16);A=I>>>16,y[v]=(I&=65535)<<16|(P&=65535)}return new o(y,-2147483648&y[y.length-1]?-1:0)},r.j=function(E){if(R(this)||R(E))return p;if(x(this))return x(E)?C(this).j(C(E)):C(C(this).j(E));if(x(E))return C(this.j(C(E)));if(0>this.l(T)&&0>E.l(T))return h(this.m()*E.m());for(var g=this.g.length+E.g.length,y=[],A=0;A<2*g;A++)y[A]=0;for(A=0;A<this.g.length;A++)for(var v=0;v<E.g.length;v++){var P=this.i(A)>>>16,I=65535&this.i(A),Ct=E.i(v)>>>16,Xs=65535&E.i(v);y[2*A+2*v]+=I*Xs,q(y,2*A+2*v),y[2*A+2*v+1]+=P*Xs,q(y,2*A+2*v+1),y[2*A+2*v+1]+=I*Ct,q(y,2*A+2*v+1),y[2*A+2*v+2]+=P*Ct,q(y,2*A+2*v+2)}for(A=0;A<g;A++)y[A]=y[2*A+1]<<16|y[2*A];for(A=g;A<2*g;A++)y[A]=0;return new o(y,0)},r.A=function(E){return z(this,E).h},r.and=function(E){for(var g=Math.max(this.g.length,E.g.length),y=[],A=0;A<g;A++)y[A]=this.i(A)&E.i(A);return new o(y,this.h&E.h)},r.or=function(E){for(var g=Math.max(this.g.length,E.g.length),y=[],A=0;A<g;A++)y[A]=this.i(A)|E.i(A);return new o(y,this.h|E.h)},r.xor=function(E){for(var g=Math.max(this.g.length,E.g.length),y=[],A=0;A<g;A++)y[A]=this.i(A)^E.i(A);return new o(y,this.h^E.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,vh=Ah.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=function f(E,g){if(0==E.length)throw Error("number format error: empty string");if(2>(g=g||10)||36<g)throw Error("radix out of range: "+g);if("-"==E.charAt(0))return C(f(E.substring(1),g));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=h(Math.pow(g,8)),A=p,v=0;v<E.length;v+=8){var P=Math.min(8,E.length-v),I=parseInt(E.substring(v,v+P),g);8>P?(P=h(Math.pow(g,P)),A=A.j(P).add(h(I))):A=(A=A.j(y)).add(h(I))}return A},Ot=Ah.Integer=o}).apply(typeof Eh<"u"?Eh:typeof self<"u"?self:typeof window<"u"?window:{});var wh,ts,bh,Ei,_a,Rh,Sh,Ph,Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Tt={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a},n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ti&&Ti];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function s(a,l){if(l)e:{var d=n;a=a.split(".");for(var m=0;m<a.length-1;m++){var w=a[m];if(!(w in d))break e;d=d[w]}(l=l(m=d[a=a[a.length-1]]))!=m&&null!=l&&e(d,a,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(a){return a||function(){return function i(a,l){a instanceof String&&(a+="");var d=0,m=!1,w={next:function(){if(!m&&d<a.length){var V=d++;return{value:l(V,a[V]),done:!1}}return m=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}(this,function(l,d){return d})}});var o=o||{},u=this||self;function c(a){var l=typeof a;return"array"==(l="object"!=l?l:a?Array.isArray(a)?"array":l:"null")||"object"==l&&"number"==typeof a.length}function h(a){var l=typeof a;return"object"==l&&null!=a||"function"==l}function f(a,l,d){return a.call.apply(a.bind,arguments)}function p(a,l,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,m),a.apply(l,w)}}return function(){return a.apply(l,arguments)}}function _(a,l,d){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:p).apply(null,arguments)}function T(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function R(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,w,V){for(var L=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)L[oe-2]=arguments[oe];return l.prototype[w].apply(m,L)}}function x(a){const l=a.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function C(a,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const w=a.length||0,V=m.length||0;a.length=w+V;for(let L=0;L<V;L++)a[w+L]=m[L]}else a.push(m)}}function q(a){return/^[\s\xa0]*$/.test(a)}function F(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function z(a){return z[" "](a),a}z[" "]=function(){};var X=!(-1==F().indexOf("Gecko")||-1!=F().toLowerCase().indexOf("webkit")&&-1==F().indexOf("Edge")||-1!=F().indexOf("Trident")||-1!=F().indexOf("MSIE")||-1!=F().indexOf("Edge"));function W(a,l,d){for(const m in a)l.call(d,a[m],m,a)}function g(a){const l={};for(const d in a)l[d]=a[d];return l}const y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(a,l){let d,m;for(let w=1;w<arguments.length;w++){for(d in m=arguments[w],m)a[d]=m[d];for(let V=0;V<y.length;V++)d=y[V],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function v(a){var l=1;a=a.split(":");const d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function P(a){u.setTimeout(()=>{throw a},0)}function I(){var a=pl;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}var Xs=new class U{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new hw,a=>a.reset());class hw{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Js,Ys=!1,pl=new class Ct{constructor(){this.h=this.g=null}add(l,d){const m=Xs.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},p_=()=>{const a=u.Promise.resolve(void 0);Js=()=>{a.then(dw)}};var dw=()=>{for(var a;a=I();){try{a.h.call(a.g)}catch(d){P(d)}var l=Xs;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}Ys=!1};function rn(){this.s=this.s,this.C=this.C}function ke(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}rn.prototype.s=!1,rn.prototype.ma=function(){this.s||(this.s=!0,this.N())},rn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},ke.prototype.h=function(){this.defaultPrevented=!0};var fw=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return a}();function Zs(a,l){if(ke.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(X){e:{try{z(l.nodeName);var w=!0;break e}catch{}w=!1}w||(l=null)}}else"mouseover"==d?l=a.fromElement:"mouseout"==d&&(l=a.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:pw[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Zs.aa.h.call(this)}}R(Zs,ke);var pw={2:"touch",3:"pen",4:"mouse"};Zs.prototype.h=function(){Zs.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ei="closure_listenable_"+(1e6*Math.random()|0),mw=0;function _w(a,l,d,m,w){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=w,this.key=++mw,this.da=this.fa=!1}function Oo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Mo(a){this.src=a,this.g={},this.h=0}function ml(a,l){var d=l.type;if(d in a.g){var V,m=a.g[d],w=Array.prototype.indexOf.call(m,l,void 0);(V=0<=w)&&Array.prototype.splice.call(m,w,1),V&&(Oo(l),0==a.g[d].length&&(delete a.g[d],a.h--))}}function _l(a,l,d,m){for(var w=0;w<a.length;++w){var V=a[w];if(!V.da&&V.listener==l&&V.capture==!!d&&V.ha==m)return w}return-1}Mo.prototype.add=function(a,l,d,m,w){var V=a.toString();(a=this.g[V])||(a=this.g[V]=[],this.h++);var L=_l(a,l,m,w);return-1<L?(l=a[L],d||(l.fa=!1)):((l=new _w(l,this.src,V,!!m,w)).fa=d,a.push(l)),l};var gl="closure_lm_"+(1e6*Math.random()|0),yl={};function m_(a,l,d,m,w){if(m&&m.once)return g_(a,l,d,m,w);if(Array.isArray(l)){for(var V=0;V<l.length;V++)m_(a,l[V],d,m,w);return null}return d=Al(d),a&&a[ei]?a.K(l,d,h(m)?!!m.capture:!!m,w):__(a,l,d,!1,m,w)}function __(a,l,d,m,w,V){if(!l)throw Error("Invalid event type");var L=h(w)?!!w.capture:!!w,oe=Tl(a);if(oe||(a[gl]=oe=new Mo(a)),(d=oe.add(l,d,m,L,V)).proxy)return d;if(m=function gw(){const l=yw;return function a(d){return l.call(a.src,a.listener,d)}}(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)fw||(w=L),void 0===w&&(w=!1),a.addEventListener(l.toString(),m,w);else if(a.attachEvent)a.attachEvent(I_(l.toString()),m);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(m)}return d}function g_(a,l,d,m,w){if(Array.isArray(l)){for(var V=0;V<l.length;V++)g_(a,l[V],d,m,w);return null}return d=Al(d),a&&a[ei]?a.L(l,d,h(m)?!!m.capture:!!m,w):__(a,l,d,!0,m,w)}function y_(a,l,d,m,w){if(Array.isArray(l))for(var V=0;V<l.length;V++)y_(a,l[V],d,m,w);else m=h(m)?!!m.capture:!!m,d=Al(d),a&&a[ei]?(a=a.i,(l=String(l).toString())in a.g&&-1<(d=_l(V=a.g[l],d,m,w))&&(Oo(V[d]),Array.prototype.splice.call(V,d,1),0==V.length&&(delete a.g[l],a.h--))):a&&(a=Tl(a))&&(l=a.g[l.toString()],a=-1,l&&(a=_l(l,d,m,w)),(d=-1<a?l[a]:null)&&Il(d))}function Il(a){if("number"!=typeof a&&a&&!a.da){var l=a.src;if(l&&l[ei])ml(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(I_(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=Tl(l))?(ml(d,a),0==d.h&&(d.src=null,l[gl]=null)):Oo(a)}}}function I_(a){return a in yl?yl[a]:yl[a]="on"+a}function yw(a,l){if(a.da)a=!0;else{l=new Zs(l,this);var d=a.listener,m=a.ha||a.src;a.fa&&Il(a),a=d.call(m,l)}return a}function Tl(a){return(a=a[gl])instanceof Mo?a:null}var El="__closure_events_fn_"+(1e9*Math.random()>>>0);function Al(a){return"function"==typeof a?a:(a[El]||(a[El]=function(l){return a.handleEvent(l)}),a[El])}function Oe(){rn.call(this),this.i=new Mo(this),this.M=this,this.F=null}function Be(a,l){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=l.type||l,"string"==typeof l)l=new ke(l,a);else if(l instanceof ke)l.target=l.target||a;else{var w=l;A(l=new ke(m,a),w)}if(w=!0,d)for(var V=d.length-1;0<=V;V--){var L=l.g=d[V];w=Fo(L,m,!0,l)&&w}if(w=Fo(L=l.g=a,m,!0,l)&&w,w=Fo(L,m,!1,l)&&w,d)for(V=0;V<d.length;V++)w=Fo(L=l.g=d[V],m,!1,l)&&w}function Fo(a,l,d,m){if(!(l=a.i.g[String(l)]))return!0;l=l.concat();for(var w=!0,V=0;V<l.length;++V){var L=l[V];if(L&&!L.da&&L.capture==d){var oe=L.listener,Ve=L.ha||L.src;L.fa&&ml(a.i,L),w=!1!==oe.call(Ve,m)&&w}}return w&&!m.defaultPrevented}function T_(a,l,d){if("function"==typeof a)d&&(a=_(a,d));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=_(a.handleEvent,a)}return 2147483647<Number(l)?-1:u.setTimeout(a,l||0)}function E_(a){a.g=T_(()=>{a.g=null,a.i&&(a.i=!1,E_(a))},a.l);const l=a.h;a.h=null,a.m.apply(null,l)}R(Oe,rn),Oe.prototype[ei]=!0,Oe.prototype.removeEventListener=function(a,l,d,m){y_(this,a,l,d,m)},Oe.prototype.N=function(){if(Oe.aa.N.call(this),this.i){var l,a=this.i;for(l in a.g){for(var d=a.g[l],m=0;m<d.length;m++)Oo(d[m]);delete a.g[l],a.h--}}this.F=null},Oe.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},Oe.prototype.L=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};class Iw extends rn{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:E_(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ti(a){rn.call(this),this.h=a,this.g={}}R(ti,rn);var A_=[];function v_(a){W(a.g,function(l,d){this.g.hasOwnProperty(d)&&Il(l)},a),a.g={}}ti.prototype.N=function(){ti.aa.N.call(this),v_(this)},ti.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var vl=u.JSON.stringify,Tw=u.JSON.parse,Ew=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function wl(){}function b_(){}wl.prototype.h=null;var ni={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function bl(){ke.call(this,"d")}function Rl(){ke.call(this,"c")}R(bl,ke),R(Rl,ke);var Gn={},R_=null;function Lo(){return R_=R_||new Oe}function S_(a){ke.call(this,Gn.La,a)}function ri(a){const l=Lo();Be(l,new S_(l))}function P_(a,l){ke.call(this,Gn.STAT_EVENT,a),this.stat=l}function qe(a){const l=Lo();Be(l,new P_(l,a))}function V_(a,l){ke.call(this,Gn.Ma,a),this.size=l}function si(a,l){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},l)}function ii(){this.g=!0}function zr(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+function bw(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var w=m[1];if(Array.isArray(w)&&!(1>w.length)){var V=w[0];if("noop"!=V&&"stop"!=V&&"close"!=V)for(var L=1;L<w.length;L++)w[L]=""}}}return vl(d)}catch{return l}}(a,d)+(m?" "+m:"")})}Gn.La="serverreachability",R(S_,ke),Gn.STAT_EVENT="statevent",R(P_,ke),Gn.Ma="timingevent",R(V_,ke),ii.prototype.xa=function(){this.g=!1},ii.prototype.info=function(){};var Sl,Uo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},C_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Bo(){}function sn(a,l,d,m){this.j=a,this.i=l,this.l=d,this.R=m||1,this.U=new ti(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new x_}function x_(){this.i=null,this.g="",this.h=!1}R(Bo,wl),Bo.prototype.g=function(){return new XMLHttpRequest},Bo.prototype.i=function(){return{}},Sl=new Bo;var D_={},Pl={};function Vl(a,l,d){a.L=1,a.v=zo(xt(l)),a.m=d,a.P=!0,N_(a,null)}function N_(a,l){a.F=Date.now(),qo(a),a.A=xt(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),H_(d.i,"t",m),a.C=0,d=a.j.J,a.h=new x_,a.g=hg(a.j,d?l:null,!a.m),0<a.O&&(a.M=new Iw(_(a.Y,a,a.g),a.O)),l=a.U,d=a.g,m=a.ca;var w="readystatechange";Array.isArray(w)||(w&&(A_[0]=w.toString()),w=A_);for(var V=0;V<w.length;V++){var L=m_(d,w[V],m||l.handleEvent,!1,l.h||l);if(!L)break;l.g[L.key]=L}l=a.H?g(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),ri(),function Aw(a,l,d,m,w,V){a.info(function(){if(a.g)if(V)for(var L="",oe=V.split("&"),Ve=0;Ve<oe.length;Ve++){var ee=oe[Ve].split("=");if(1<ee.length){var Me=ee[0];ee=ee[1];var Fe=Me.split("_");L=2<=Fe.length&&"type"==Fe[1]?L+(Me+"=")+ee+"&":L+(Me+"=redacted&")}}else L=null;else L=V;return"XMLHTTP REQ ("+m+") [attempt "+w+"]: "+l+"\n"+d+"\n"+L})}(a.i,a.u,a.A,a.l,a.R,a.m)}function k_(a){return!!a.g&&"GET"==a.u&&2!=a.L&&a.j.Ca}function Rw(a,l){var d=a.C,m=l.indexOf("\n",d);return-1==m?Pl:(d=Number(l.substring(d,m)),isNaN(d)?D_:(m+=1)+d>l.length?Pl:(l=l.slice(m,m+d),a.C=m+d,l))}function qo(a){a.S=Date.now()+a.I,O_(a,a.I)}function O_(a,l){if(null!=a.B)throw Error("WatchDog timer not null");a.B=si(_(a.ba,a),l)}function Cl(a){a.B&&(u.clearTimeout(a.B),a.B=null)}function oi(a){0==a.j.G||a.J||ag(a.j,a)}function zn(a){Cl(a);var l=a.M;l&&"function"==typeof l.ma&&l.ma(),a.M=null,v_(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function xl(a,l){try{var d=a.j;if(0!=d.G&&(d.g==a||Dl(d.h,a)))if(!a.K&&Dl(d.h,a)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var w=m;if(0==w[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<a.F))break e;Qo(d),Ho(d)}Ml(d),qe(18)}}else d.za=w[1],0<d.za-d.T&&37500>w[2]&&d.F&&0==d.v&&!d.C&&(d.C=si(_(d.Za,d),6e3));if(1>=L_(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Kn(d,11)}else if((a.K||d.g==a)&&Qo(d),!q(l))for(w=d.Da.g.parse(l),l=0;l<w.length;l++){let ee=w[l];if(d.T=ee[0],ee=ee[1],2==d.G)if("c"==ee[0]){d.K=ee[1],d.ia=ee[2];const Me=ee[3];null!=Me&&(d.la=Me,d.j.info("VER="+d.la));const Fe=ee[4];null!=Fe&&(d.Aa=Fe,d.j.info("SVER="+d.Aa));const Hr=ee[5];null!=Hr&&"number"==typeof Hr&&0<Hr&&(d.L=m=1.5*Hr,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const ot=a.g;if(ot){const Jo=ot.g?ot.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Jo){var V=m.h;V.g||-1==Jo.indexOf("spdy")&&-1==Jo.indexOf("quic")&&-1==Jo.indexOf("h2")||(V.j=V.l,V.g=new Set,V.h&&(Nl(V,V.h),V.h=null))}if(m.D){const Ll=ot.g?ot.g.getResponseHeader("X-HTTP-Session-Id"):null;Ll&&(m.ya=Ll,ce(m.I,m.D,Ll))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms"));var L=a;if((m=d).qa=lg(m,m.J?m.ia:null,m.W),L.K){U_(m.h,L);var oe=L,Ve=m.L;Ve&&(oe.I=Ve),oe.B&&(Cl(oe),qo(oe)),m.g=L}else ig(m);0<d.i.length&&Wo(d)}else"stop"!=ee[0]&&"close"!=ee[0]||Kn(d,7);else 3==d.G&&("stop"==ee[0]||"close"==ee[0]?"stop"==ee[0]?Kn(d,7):Ol(d):"noop"!=ee[0]&&d.l&&d.l.ta(ee),d.v=0)}ri()}catch{}}sn.prototype.ca=function(a){a=a.target;const l=this.M;l&&3==Dt(a)?l.j():this.Y(a)},sn.prototype.Y=function(a){try{if(a==this.g)e:{const Fe=Dt(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Fe)&&(3!=Fe||this.g&&(this.h.h||this.g.oa()||eg(this.g)))){this.J||4!=Fe||7==l||ri(),Cl(this);var d=this.g.Z();this.X=d;t:if(k_(this)){var m=eg(this.g);a="";var w=m.length,V=4==Dt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){zn(this),oi(this);var L="";break t}this.h.i=new u.TextDecoder}for(l=0;l<w;l++)this.h.h=!0,a+=this.h.i.decode(m[l],{stream:!(V&&l==w-1)});m.length=0,this.h.g+=a,this.C=0,L=this.h.g}else L=this.g.oa();if(this.o=200==d,function vw(a,l,d,m,w,V,L){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+w+"]: "+l+"\n"+d+"\n"+V+" "+L})}(this.i,this.u,this.A,this.l,this.R,Fe,d),this.o){if(this.T&&!this.K){t:{if(this.g){var oe,Ve=this.g;if((oe=Ve.g?Ve.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(oe)){var ee=oe;break t}}ee=null}if(!(d=ee)){this.o=!1,this.s=3,qe(12),zn(this),oi(this);break e}zr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,xl(this,d)}if(this.P){let ot;for(d=!0;!this.J&&this.C<L.length;){if(ot=Rw(this,L),ot==Pl){4==Fe&&(this.s=4,qe(14),d=!1),zr(this.i,this.l,null,"[Incomplete Response]");break}if(ot==D_){this.s=4,qe(15),zr(this.i,this.l,L,"[Invalid Chunk]"),d=!1;break}zr(this.i,this.l,ot,null),xl(this,ot)}if(k_(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Fe||0!=L.length||this.h.h||(this.s=1,qe(16),d=!1),this.o=this.o&&d,d){if(0<L.length&&!this.W){this.W=!0;var Me=this.j;Me.g==this&&Me.ba&&!Me.M&&(Me.j.info("Great, no buffering proxy detected. Bytes received: "+L.length),Fl(Me),Me.M=!0,qe(11))}}else zr(this.i,this.l,L,"[Invalid Chunked Response]"),zn(this),oi(this)}else zr(this.i,this.l,L,null),xl(this,L);4==Fe&&zn(this),this.o&&!this.J&&(4==Fe?ag(this.j,this):(this.o=!1,qo(this)))}else(function Gw(a){const l={};a=(a.g&&2<=Dt(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<a.length;m++){if(q(a[m]))continue;var d=v(a[m]);const w=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const V=l[w]||[];l[w]=V,V.push(d)}!function E(a,l){for(const d in a)l.call(void 0,a[d],d,a)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<L.indexOf("Unknown SID")?(this.s=3,qe(12)):(this.s=0,qe(13)),zn(this),oi(this)}}}catch{}},sn.prototype.cancel=function(){this.J=!0,zn(this)},sn.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(function ww(a,l){a.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(ri(),qe(17)),zn(this),this.s=2,oi(this)):O_(this,this.S-a)};var Sw=class{constructor(a,l){this.g=a,this.map=l}};function M_(a){this.l=a||10,a=u.PerformanceNavigationTiming?0<(a=u.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function F_(a){return!!a.h||!!a.g&&a.g.size>=a.j}function L_(a){return a.h?1:a.g?a.g.size:0}function Dl(a,l){return a.h?a.h==l:!!a.g&&a.g.has(l)}function Nl(a,l){a.g?a.g.add(l):a.h=l}function U_(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}function B_(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let l=a.i;for(const d of a.g.values())l=l.concat(d.D);return l}return x(a.i)}function q_(a,l){if(a.forEach&&"function"==typeof a.forEach)a.forEach(l,void 0);else if(c(a)||"string"==typeof a)Array.prototype.forEach.call(a,l,void 0);else for(var d=function Vw(a){if(a.na&&"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||"string"==typeof a){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(const m in a)l[d++]=m;return l}}}(a),m=function Pw(a){if(a.V&&"function"==typeof a.V)return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(c(a)){for(var l=[],d=a.length,m=0;m<d;m++)l.push(a[m]);return l}for(m in l=[],d=0,a)l[d++]=a[m];return l}(a),w=m.length,V=0;V<w;V++)l.call(void 0,m[V],d&&d[V],a)}M_.prototype.cancel=function(){if(this.i=B_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var j_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $n(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof $n){this.h=a.h,jo(this,a.j),this.o=a.o,this.g=a.g,Go(this,a.s),this.l=a.l;var l=a.i,d=new ci;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),G_(this,d),this.m=a.m}else a&&(l=String(a).match(j_))?(this.h=!1,jo(this,l[1]||"",!0),this.o=ai(l[2]||""),this.g=ai(l[3]||"",!0),Go(this,l[4]),this.l=ai(l[5]||"",!0),G_(this,l[6]||"",!0),this.m=ai(l[7]||"")):(this.h=!1,this.i=new ci(null,this.h))}function xt(a){return new $n(a)}function jo(a,l,d){a.j=d?ai(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Go(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function G_(a,l,d){l instanceof ci?(a.i=l,function Mw(a,l){l&&!a.j&&(on(a),a.i=null,a.g.forEach(function(d,m){var w=m.toLowerCase();m!=w&&($_(this,m),H_(this,w,d))},a)),a.j=l}(a.i,a.h)):(d||(l=ui(l,kw)),a.i=new ci(l,a.h))}function ce(a,l,d){a.i.set(l,d)}function zo(a){return ce(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ai(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ui(a,l,d){return"string"==typeof a?(a=encodeURI(a).replace(l,xw),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function xw(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}$n.prototype.toString=function(){var a=[],l=this.j;l&&a.push(ui(l,z_,!0),":");var d=this.g;return(d||"file"==l)&&(a.push("//"),(l=this.o)&&a.push(ui(l,z_,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&a.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&a.push("/"),a.push(ui(d,"/"==d.charAt(0)?Nw:Dw,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",ui(d,Ow)),a.join("")};var z_=/[#\/\?@]/g,Dw=/[#\?:]/g,Nw=/[#\?]/g,kw=/[#\?@]/g,Ow=/#/g;function ci(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function on(a){a.g||(a.g=new Map,a.h=0,a.i&&function Cw(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),w=null;if(0<=m){var V=a[d].substring(0,m);w=a[d].substring(m+1)}else V=a[d];l(V,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function $_(a,l){on(a),l=$r(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function K_(a,l){return on(a),l=$r(a,l),a.g.has(l)}function H_(a,l,d){$_(a,l),0<d.length&&(a.i=null,a.g.set($r(a,l),x(d)),a.h+=d.length)}function $r(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function an(a,l,d,m,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),m(d)}catch{}}function Uw(){this.g=new Ew}function Bw(a,l,d){const m=d||"";try{q_(a,function(w,V){let L=w;h(w)&&(L=vl(w)),l.push(m+V+"="+encodeURIComponent(L))})}catch(w){throw l.push(m+"type="+encodeURIComponent("_badmap")),w}}function li(a){this.l=a.Ub||null,this.j=a.eb||!1}function $o(a,l){Oe.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function W_(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function hi(a){a.readyState=4,a.l=null,a.j=null,a.v=null,di(a)}function di(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function Q_(a){let l="";return W(a,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function kl(a,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Q_(d),"string"==typeof a?null!=d&&encodeURIComponent(String(d)):ce(a,l,d))}function ge(a){Oe.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ci.prototype).add=function(a,l){on(this),this.i=null,a=$r(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this},r.forEach=function(a,l){on(this),this.g.forEach(function(d,m){d.forEach(function(w){a.call(l,w,m,this)},this)},this)},r.na=function(){on(this);const a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const w=a[m];for(let V=0;V<w.length;V++)d.push(l[m])}return d},r.V=function(a){on(this);let l=[];if("string"==typeof a)K_(this,a)&&(l=l.concat(this.g.get($r(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},r.set=function(a,l){return on(this),this.i=null,K_(this,a=$r(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a&&0<(a=this.V(a)).length?String(a[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const V=encodeURIComponent(String(m)),L=this.V(m);for(m=0;m<L.length;m++){var w=V;""!==L[m]&&(w+="="+encodeURIComponent(String(L[m]))),a.push(w)}}return this.i=a.join("&")},R(li,wl),li.prototype.g=function(){return new $o(this.l,this.j)},li.prototype.i=function(a){return function(){return a}}({}),R($o,Oe),(r=$o.prototype).open=function(a,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,di(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hi(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,di(this)),this.g&&(this.readyState=3,di(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;W_(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?hi(this):di(this),3==this.readyState&&W_(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,hi(this))},r.Qa=function(a){this.g&&(this.response=a,hi(this))},r.ga=function(){this.g&&hi(this)},r.setRequestHeader=function(a,l){this.u.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],l=this.h.entries();for(var d=l.next();!d.done;)a.push((d=d.value)[0]+": "+d[1]),d=l.next();return a.join("\r\n")},Object.defineProperty($o.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),R(ge,Oe);var qw=/^https?$/i,jw=["POST","PUT"];function X_(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,J_(a),Ko(a)}function J_(a){a.A||(a.A=!0,Be(a,"complete"),Be(a,"error"))}function Y_(a){if(a.h&&typeof o<"u"&&(!a.v[1]||4!=Dt(a)||2!=a.Z()))if(a.u&&4==Dt(a))T_(a.Ea,0,a);else if(Be(a,"readystatechange"),4==Dt(a)){a.h=!1;try{const L=a.Z();e:switch(L){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===L){var w=String(a.D).match(j_)[1]||null;!w&&u.self&&u.self.location&&(w=u.self.location.protocol.slice(0,-1)),m=!qw.test(w?w.toLowerCase():"")}d=m}if(d)Be(a,"complete"),Be(a,"success");else{a.m=6;try{var V=2<Dt(a)?a.g.statusText:""}catch{V=""}a.l=V+" ["+a.Z()+"]",J_(a)}}finally{Ko(a)}}}function Ko(a,l){if(a.g){Z_(a);const d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Be(a,"ready");try{d.onreadystatechange=m}catch{}}}function Z_(a){a.I&&(u.clearTimeout(a.I),a.I=null)}function Dt(a){return a.g?a.g.readyState:0}function eg(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function fi(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function tg(a){this.Aa=0,this.i=[],this.j=new ii,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=fi("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=fi("baseRetryDelayMs",5e3,a),this.cb=fi("retryDelaySeedMs",1e4,a),this.Wa=fi("forwardChannelMaxRetries",2,a),this.wa=fi("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new M_(a&&a.concurrentRequestLimit),this.Da=new Uw,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Ol(a){if(ng(a),3==a.G){var l=a.U++,d=xt(a.I);if(ce(d,"SID",a.K),ce(d,"RID",l),ce(d,"TYPE","terminate"),pi(a,d),(l=new sn(a,a.j,l)).L=2,l.v=zo(xt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=hg(l.j,null),l.g.ea(l.v)),l.F=Date.now(),qo(l)}cg(a)}function Ho(a){a.g&&(Fl(a),a.g.cancel(),a.g=null)}function ng(a){Ho(a),a.u&&(u.clearTimeout(a.u),a.u=null),Qo(a),a.h.cancel(),a.s&&("number"==typeof a.s&&u.clearTimeout(a.s),a.s=null)}function Wo(a){if(!F_(a.h)&&!a.s){a.s=!0;var l=a.Ga;Js||p_(),Ys||(Js(),Ys=!0),pl.add(l,a),a.B=0}}function rg(a,l){var d;d=l?l.l:a.U++;const m=xt(a.I);ce(m,"SID",a.K),ce(m,"RID",d),ce(m,"AID",a.T),pi(a,m),a.m&&a.o&&kl(m,a.m,a.o),d=new sn(a,a.j,d,a.B+1),null===a.m&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=sg(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Nl(a.h,d),Vl(d,m,l)}function pi(a,l){a.H&&W(a.H,function(d,m){ce(l,m,d)}),a.l&&q_({},function(d,m){ce(l,m,d)})}function sg(a,l,d){d=Math.min(a.i.length,d);var m=a.l?_(a.l.Na,a.l,a):null;e:{var w=a.i;let V=-1;for(;;){const L=["count="+d];-1==V?0<d?(V=w[0].g,L.push("ofs="+V)):V=0:L.push("ofs="+V);let oe=!0;for(let Ve=0;Ve<d;Ve++){let ee=w[Ve].g;const Me=w[Ve].map;if(ee-=V,0>ee)V=Math.max(0,w[Ve].g-100),oe=!1;else try{Bw(Me,L,"req"+ee+"_")}catch{m&&m(Me)}}if(oe){m=L.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,m}function ig(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;Js||p_(),Ys||(Js(),Ys=!0),pl.add(l,a),a.v=0}}function Ml(a){return!(a.g||a.u||3<=a.v||(a.Y++,a.u=si(_(a.Fa,a),ug(a,a.v)),a.v++,0))}function Fl(a){null!=a.A&&(u.clearTimeout(a.A),a.A=null)}function og(a){a.g=new sn(a,a.j,"rpc",a.Y),null===a.m&&(a.g.H=a.o),a.g.O=0;var l=xt(a.qa);ce(l,"RID","rpc"),ce(l,"SID",a.K),ce(l,"AID",a.T),ce(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&ce(l,"TO",a.ja),ce(l,"TYPE","xmlhttp"),pi(a,l),a.m&&a.o&&kl(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=zo(xt(l)),d.m=null,d.P=!0,N_(d,a)}function Qo(a){null!=a.C&&(u.clearTimeout(a.C),a.C=null)}function ag(a,l){var d=null;if(a.g==l){Qo(a),Fl(a),a.g=null;var m=2}else{if(!Dl(a.h,l))return;d=l.D,U_(a.h,l),m=1}if(0!=a.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var w=a.B;Be(m=Lo(),new V_(m,d)),Wo(a)}else ig(a);else if(3==(w=l.s)||0==w&&0<l.X||!(1==m&&function zw(a,l){return!(L_(a.h)>=a.h.j-(a.s?1:0)||(a.s?(a.i=l.D.concat(a.i),0):1==a.G||2==a.G||a.B>=(a.Va?0:a.Wa)||(a.s=si(_(a.Ga,a,l),ug(a,a.B)),a.B++,0)))}(a,l)||2==m&&Ml(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),w){case 1:Kn(a,5);break;case 4:Kn(a,10);break;case 3:Kn(a,6);break;default:Kn(a,2)}}function ug(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function Kn(a,l){if(a.j.info("Error code "+l),2==l){var d=_(a.fb,a),m=a.Xa;const w=!m;m=new $n(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||jo(m,"https"),zo(m),w?function Fw(a,l){const d=new ii;if(u.Image){const m=new Image;m.onload=T(an,d,"TestLoadImage: loaded",!0,l,m),m.onerror=T(an,d,"TestLoadImage: error",!1,l,m),m.onabort=T(an,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=T(an,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}(m.toString(),d):function Lw(a,l){new ii;const m=new AbortController,w=setTimeout(()=>{m.abort(),an(0,0,!1,l)},1e4);fetch(a,{signal:m.signal}).then(V=>{clearTimeout(w),an(0,0,!!V.ok,l)}).catch(()=>{clearTimeout(w),an(0,0,!1,l)})}(m.toString(),d)}else qe(2);a.G=0,a.l&&a.l.sa(l),cg(a),ng(a)}function cg(a){if(a.G=0,a.ka=[],a.l){const l=B_(a.h);(0!=l.length||0!=a.i.length)&&(C(a.ka,l),C(a.ka,a.i),a.h.i.length=0,x(a.i),a.i.length=0),a.l.ra()}}function lg(a,l,d){var m=d instanceof $n?xt(d):new $n(d);if(""!=m.g)l&&(m.g=l+"."+m.g),Go(m,m.s);else{var w=u.location;m=w.protocol,l=l?l+"."+w.hostname:w.hostname,w=+w.port;var V=new $n(null);m&&jo(V,m),l&&(V.g=l),w&&Go(V,w),d&&(V.l=d),m=V}return l=a.ya,(d=a.D)&&l&&ce(m,d,l),ce(m,"VER",a.la),pi(a,m),m}function hg(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new ge(a.Ca&&!a.pa?new li({eb:d}):a.pa)).Ha(a.J),l}function dg(){}function Xo(){}function Ze(a,l){Oe.call(this),this.g=new tg(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!q(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!q(l)&&(this.g.D=l,null!==(a=this.h)&&l in a&&l in(a=this.h)&&delete a[l]),this.j=new Kr(this)}function fg(a){bl.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(const d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=null!==l&&a in l?l[a]:void 0),this.data=l}else this.data=a}function pg(){Rl.call(this),this.status=1}function Kr(a){this.g=a}(r=ge.prototype).Ha=function(a){this.J=a},r.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Sl.g(),this.v=function w_(a){return a.h||(a.h=a.i())}(this.o?this.o:Sl),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(V){return void X_(this,V)}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var w in m)d.set(w,m[w]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const V of m.keys())d.set(V,m.get(V))}m=Array.from(d.keys()).find(V=>"content-type"==V.toLowerCase()),w=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(jw,l,void 0))||m||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[V,L]of d)this.g.setRequestHeader(V,L);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Z_(this),this.u=!0,this.g.send(a),this.u=!1}catch(V){X_(this,V)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Be(this,"complete"),Be(this,"abort"),Ko(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ko(this,!0)),ge.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Y_(this):this.bb())},r.bb=function(){Y_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Dt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&0==l.indexOf(a)&&(l=l.substring(a.length)),Tw(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=tg.prototype).la=8,r.G=1,r.connect=function(a,l,d,m){qe(0),this.W=a,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=lg(this,null,this.W),Wo(this)},r.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const w=new sn(this,this.j,a);let V=this.o;if(this.S&&(V?(V=g(V),A(V,this.S)):V=this.S),null!==this.m||this.O||(w.H=V,V=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=sg(this,w,l),ce(d=xt(this.I),"RID",a),ce(d,"CVER",22),this.D&&ce(d,"X-HTTP-Session-Id",this.D),pi(this,d),V&&(this.O?l="headers="+encodeURIComponent(String(Q_(V)))+"&"+l:this.m&&kl(d,this.m,V)),Nl(this.h,w),this.Ua&&ce(d,"TYPE","init"),this.P?(ce(d,"$req",l),ce(d,"SID","null"),w.T=!0,Vl(w,d,null)):Vl(w,d,l),this.G=2}}else 3==this.G&&(a?rg(this,a):0==this.i.length||F_(this.h)||rg(this))},r.Fa=function(){if(this.u=null,og(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=si(_(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qe(10),Ho(this),og(this))},r.Za=function(){null!=this.C&&(this.C=null,Ho(this),Ml(this),qe(19))},r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=dg.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Xo.prototype.g=function(a,l){return new Ze(a,l)},R(Ze,Oe),Ze.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ze.prototype.close=function(){Ol(this.g)},Ze.prototype.o=function(a){var l=this.g;if("string"==typeof a){var d={};d.__data__=a,a=d}else this.u&&((d={}).__data__=vl(a),a=d);l.i.push(new Sw(l.Ya++,a)),3==l.G&&Wo(l)},Ze.prototype.N=function(){this.g.l=null,delete this.j,Ol(this.g),delete this.g,Ze.aa.N.call(this)},R(fg,bl),R(pg,Rl),R(Kr,dg),Kr.prototype.ua=function(){Be(this.g,"a")},Kr.prototype.ta=function(a){Be(this.g,new fg(a))},Kr.prototype.sa=function(a){Be(this.g,new pg)},Kr.prototype.ra=function(){Be(this.g,"b")},Xo.prototype.createWebChannel=Xo.prototype.g,Ze.prototype.send=Ze.prototype.o,Ze.prototype.open=Ze.prototype.m,Ze.prototype.close=Ze.prototype.close,Ph=Tt.createWebChannelTransport=function(){return new Xo},Sh=Tt.getStatEventTarget=function(){return Lo()},Rh=Tt.Event=Gn,_a=Tt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Uo.NO_ERROR=0,Uo.TIMEOUT=8,Uo.HTTP_ERROR=6,Ei=Tt.ErrorCode=Uo,C_.COMPLETE="complete",bh=Tt.EventType=C_,b_.EventType=ni,ni.OPEN="a",ni.CLOSE="b",ni.ERROR="c",ni.MESSAGE="d",Oe.prototype.listen=Oe.prototype.K,ts=Tt.WebChannel=b_,Tt.FetchXmlHttpFactory=li,ge.prototype.listenOnce=ge.prototype.L,ge.prototype.getLastError=ge.prototype.Ka,ge.prototype.getLastErrorCode=ge.prototype.Ba,ge.prototype.getStatus=ge.prototype.Z,ge.prototype.getResponseJson=ge.prototype.Oa,ge.prototype.getResponseText=ge.prototype.oa,ge.prototype.send=ge.prototype.ea,ge.prototype.setWithCredentials=ge.prototype.Ha,wh=Tt.XhrIo=ge}).apply(typeof Ti<"u"?Ti:typeof self<"u"?self:typeof window<"u"?window:{});const Vh="@firebase/firestore";class ve{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");let Yn="12.0.0";const Mt=new nh("@firebase/firestore");function Zn(){return Mt.logLevel}function k(r,...e){if(Mt.logLevel<=Y.DEBUG){const t=e.map(ga);Mt.debug(`Firestore (${Yn}): ${r}`,...t)}}function ye(r,...e){if(Mt.logLevel<=Y.ERROR){const t=e.map(ga);Mt.error(`Firestore (${Yn}): ${r}`,...t)}}function et(r,...e){if(Mt.logLevel<=Y.WARN){const t=e.map(ga);Mt.warn(`Firestore (${Yn}): ${r}`,...t)}}function ga(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function B(r,e,t){let n="Unexpected state";"string"==typeof e?n=e:t=e,xh(r,n,t)}function xh(r,e,t){let n=`FIRESTORE (${Yn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(void 0!==t)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw ye(n),new Error(n)}function j(r,e,t,n){let s="Unexpected state";"string"==typeof t?s=t:n=t,r||xh(e,s,n)}function M(r,e){return r}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends fn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class we{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Dh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ky{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ve.UNAUTHENTICATED))}shutdown(){}}class Hy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Wy{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;j(void 0===this.o,42304);let s=this.i;const i=h=>this.i!==s?(s=this.i,t(h)):Promise.resolve();let o=new we;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new we,e.enqueueRetryable(()=>i(this.currentUser))};const u=()=>{const h=o;e.enqueueRetryable((0,N.A)(function*(){yield h.promise,yield i(n.currentUser)}))},c=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new we)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(j("string"==typeof n.accessToken,31837,{l:n}),new Dh(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return j(null===e||"string"==typeof e,2055,{h:e}),new ve(e)}}class Qy{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Xy{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Qy(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ya{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Jy{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,lh(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){j(void 0===this.o,3512);const n=i=>{null!=i.error&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,k("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const s=i=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ya(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(j("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new ya(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Yy(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class Ia{static newId(){const t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=Yy(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[i]%62))}return n}}function $(r,e){return r<e?-1:r>e?1:0}function Ta(r,e){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++){const s=r.charAt(n),i=e.charAt(n);if(s!==i)return Ea(s)===Ea(i)?$(s,i):Ea(s)?1:-1}return $(r.length,e.length)}const Zy=55296,eI=57343;function Ea(r){const e=r.charCodeAt(0);return e>=Zy&&e<=eI}function er(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}const Aa="__name__";class at{constructor(e,t,n){void 0===t?t=0:t>e.length&&B(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&B(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===at.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof at?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=at.compareSegments(e.get(s),t.get(s));if(0!==i)return i}return $(e.length,t.length)}static compareSegments(e,t){const n=at.isNumericId(e),s=at.isNumericId(t);return n&&!s?-1:!n&&s?1:n&&s?at.extractNumericId(e).compare(at.extractNumericId(t)):Ta(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ot.fromString(e.substring(4,e.length-2))}}class H extends at{construct(e,t,n){return new H(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new H(t)}static emptyPath(){return new H([])}}const tI=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class le extends at{construct(e,t,n){return new le(e,t,n)}static isValidIdentifier(e){return tI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),le.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Aa}static keyField(){return new le([Aa])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new D(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;s<e.length;){const u=e[s];if("\\"===u){if(s+1===e.length)throw new D(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new D(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,s+=2}else"`"===u?(o=!o,s++):"."!==u||o?(n+=u,s++):(i(),s++)}if(i(),o)throw new D(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new le(t)}static emptyPath(){return new le([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(H.fromString(e))}static fromName(e){return new O(H.fromString(e).popFirst(5))}static empty(){return new O(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===H.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return H.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new H(e.slice()))}}function kh(r){if(!O.isDocumentKey(r))throw new D(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Mh(r){return"object"==typeof r&&null!==r&&(Object.getPrototypeOf(r)===Object.prototype||null===Object.getPrototypeOf(r))}function Ai(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":B(12329,{type:typeof r})}function Q(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new D(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ai(r);throw new D(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function Te(r,e){const t={typeString:r};return e&&(t.value=e),t}function _n(r,e){if(!Mh(r))throw new D(S.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const s=e[n].typeString,i="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}const o=r[n];if(s&&typeof o!==s){t=`JSON field '${n}' must be a ${s}.`;break}if(void 0!==i&&o!==i.value){t=`Expected '${n}' field to equal '${i.value}'`;break}}if(t)throw new D(S.INVALID_ARGUMENT,t);return!0}const Lh=-62135596800;class te{static now(){return te.fromMillis(Date.now())}static fromDate(e){return te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new te(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Lh)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:te._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(_n(e,te._jsonSchema))return new te(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-Lh).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}te._jsonSchemaVersion="firestore/timestamp/1.0",te._jsonSchema={type:Te("string",te._jsonSchemaVersion),seconds:Te("number"),nanoseconds:Te("number")};class G{static fromTimestamp(e){return new G(e)}static min(){return new G(new te(0,0))}static max(){return new G(new te(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class He{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new He(G.min(),O.empty(),-1)}static max(){return new He(G.max(),O.empty(),-1)}}function ba(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(r.documentKey,e.documentKey),0!==t?t:$(r.largestBatchId,e.largestBatchId))}const jh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Gh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Ft(r){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,N.A)(function*(r){if(r.code!==S.FAILED_PRECONDITION||r.message!==jh)throw r;k("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):b.reject(t)}static resolve(e){return new b((t,n)=>{t(e)})}static reject(e){return new b((t,n)=>{n(e)})}static waitFor(e){return new b((t,n)=>{let s=0,i=0,o=!1;e.forEach(u=>{++s,u.next(()=>{++i,o&&i===s&&t()},c=>n(c))}),o=!0,i===s&&t()})}static or(e){let t=b.resolve(!1);for(const n of e)t=t.next(s=>s?b.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,i)=>{n.push(t.call(this,s,i))}),this.waitFor(n)}static mapArray(e,t){return new b((n,s)=>{const i=e.length,o=new Array(i);let u=0;for(let c=0;c<i;c++){const h=c;t(e[h]).next(f=>{o[h]=f,++u,u===i&&n(o)},f=>s(f))}})}static doWhile(e,t){return new b((n,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):n()};i()})}}function Lt(r){return"IndexedDbTransactionError"===r.name}let Qe=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>n.writeSequenceNumber(s))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}return r.ce=-1,r})();const Ut=-1;function ss(r){return null==r}function is(r){return 0===r&&1/r==-1/0}const wi="\x01";function cI(r,e){let t=e;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case wi:t+="\x01\x11";break;default:t+=i}}return t}function Hh(r){return r+wi+"\x01"}const as="mutationQueues",nt="mutations",ir="documentMutations",us="remoteDocumentGlobal",or="targets",ar="targetDocuments",An="targetGlobal",cs="collectionParents",ur="clientMetadata",Vi="bundles",Ci="namedQueries";function od(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Bt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function ud(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class ae{constructor(e,t){this.comparator=e,this.root=t||Se.EMPTY}insert(e,t){return new ae(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Se.BLACK,null,null))}remove(e){return new ae(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Se.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Di(this.root,e,this.comparator,!1)}getReverseIterator(){return new Di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Di(this.root,e,this.comparator,!0)}}class Di{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Se{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Se.RED,this.left=s??Se.EMPTY,this.right=i??Se.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Se(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Se.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Se.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Se.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Se.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B(43730,{key:this.key,value:this.value});if(this.right.isRed())throw B(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw B(27949);return e+(this.isRed()?0:1)}}Se.EMPTY=null,Se.RED=!0,Se.BLACK=!1,Se.EMPTY=new class{constructor(){this.size=0}get key(){throw B(57766)}get value(){throw B(16141)}get color(){throw B(16727)}get left(){throw B(29726)}get right(){throw B(36894)}copy(e,t,n,s,i){return this}insert(e,t,n){return new Se(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(e){this.comparator=e,this.data=new ae(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cd(this.data.getIterator())}getIteratorFrom(e){return new cd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ne(this.comparator);return t.data=e,t}}class cd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class je{constructor(e){this.fields=e,e.sort(le.comparator)}static empty(){return new je([])}unionWith(e){let t=new ne(le.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new je(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return er(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class ld extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class _e{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ld("Invalid base64 string: "+i):i}}(e);return new _e(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new _e(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}_e.EMPTY_BYTE_STRING=new _e("");const OI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Et(r){if(j(!!r,39018),"string"==typeof r){let e=0;const t=OI.exec(r);if(j(!!t,46558,{timestamp:r}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:he(r.seconds),nanos:he(r.nanos)}}function he(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function At(r){return"string"==typeof r?_e.fromBase64String(r):_e.fromUint8Array(r)}const hd="server_timestamp",dd="__type__",fd="__previous_value__",pd="__local_write_time__";function Ni(r){return(r?.mapValue?.fields||{})[dd]?.stringValue===hd}function ki(r){const e=r.mapValue.fields[fd];return Ni(e)?ki(e):e}function ds(r){const e=Et(r.mapValue.fields[pd].timestampValue);return new te(e.seconds,e.nanos)}class MI{constructor(e,t,n,s,i,o,u,c,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}}const fs="(default)";class vn{constructor(e,t){this.projectId=e,this.database=t||fs}static empty(){return new vn("","")}get isDefaultDatabase(){return this.database===fs}isEqual(e){return e instanceof vn&&e.projectId===this.projectId&&e.database===this.database}}const Ma="__type__",md="__max__",qt={mapValue:{fields:{__type__:{stringValue:md}}}},Fa="__vector__",lr="value";function jt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ni(r)?4:Td(r)?9007199254740991:Li(r)?10:11:B(28295,{value:r})}function lt(r,e){if(r===e)return!0;const t=jt(r);if(t!==jt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return ds(r).isEqual(ds(e));case 3:return function(s,i){if("string"==typeof s.timestampValue&&"string"==typeof i.timestampValue&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Et(s.timestampValue),u=Et(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return i=e,At(r.bytesValue).isEqual(At(i.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,i){return he(s.geoPointValue.latitude)===he(i.geoPointValue.latitude)&&he(s.geoPointValue.longitude)===he(i.geoPointValue.longitude)}(r,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return he(s.integerValue)===he(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=he(s.doubleValue),u=he(i.doubleValue);return o===u?is(o)===is(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return er(r.arrayValue.values||[],e.arrayValue.values||[],lt);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},u=i.mapValue.fields||{};if(od(o)!==od(u))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(void 0===u[c]||!lt(o[c],u[c])))return!1;return!0}(r,e);default:return B(52216,{left:r})}var i}function ps(r,e){return void 0!==(r.values||[]).find(t=>lt(t,e))}function Gt(r,e){if(r===e)return 0;const t=jt(r),n=jt(e);if(t!==n)return $(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(r.booleanValue,e.booleanValue);case 2:return function(i,o){const u=he(i.integerValue||i.doubleValue),c=he(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return _d(r.timestampValue,e.timestampValue);case 4:return _d(ds(r),ds(e));case 5:return Ta(r.stringValue,e.stringValue);case 6:return function(i,o){const u=At(i),c=At(o);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const u=i.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=$(u[h],c[h]);if(0!==f)return f}return $(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const u=$(he(i.latitude),he(o.latitude));return 0!==u?u:$(he(i.longitude),he(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return gd(r.arrayValue,e.arrayValue);case 10:return function(i,o){const u=i.fields||{},c=o.fields||{},h=u[lr]?.arrayValue,f=c[lr]?.arrayValue,p=$(h?.values?.length||0,f?.values?.length||0);return 0!==p?p:gd(h,f)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===qt.mapValue&&o===qt.mapValue)return 0;if(i===qt.mapValue)return 1;if(o===qt.mapValue)return-1;const u=i.fields||{},c=Object.keys(u),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const _=Ta(c[p],f[p]);if(0!==_)return _;const T=Gt(u[c[p]],h[f[p]]);if(0!==T)return T}return $(c.length,f.length)}(r.mapValue,e.mapValue);default:throw B(23264,{he:t})}}function _d(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return $(r,e);const t=Et(r),n=Et(e),s=$(t.seconds,n.seconds);return 0!==s?s:$(t.nanos,n.nanos)}function gd(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=Gt(t[s],n[s]);if(i)return i}return $(t.length,n.length)}function hr(r){return La(r)}function La(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Et(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?At(r.bytesValue).toBase64():"referenceValue"in r?O.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=La(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${La(t.fields[o])}`;return s+"}"}(r.mapValue):B(61005,{value:r})}function Mi(r){switch(jt(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ki(r);return e?16+Mi(e):16;case 5:return 2*r.stringValue.length;case 6:return At(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(r.arrayValue.values||[]).reduce((s,i)=>s+Mi(i),0);case 10:case 11:return function(n){let s=0;return Bt(n.fields,(i,o)=>{s+=i.length+Mi(o)}),s}(r.mapValue);default:throw B(13486,{value:r})}}function Ua(r){return!!r&&"integerValue"in r}function ms(r){return!!r&&"arrayValue"in r}function yd(r){return!!r&&"nullValue"in r}function Id(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Fi(r){return!!r&&"mapValue"in r}function Li(r){return(r?.mapValue?.fields||{})[Ma]?.stringValue===Fa}function _s(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return Bt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=_s(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=_s(r.arrayValue.values[t]);return e}return{...r}}function Td(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===md}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Fi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_s(t)}setAll(e){let t=le.emptyPath(),n={},s=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,s),n={},s=[],t=u.popLast()}o?n[u.lastSegment()]=_s(o):s.push(u.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());Fi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return lt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Fi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Bt(t,(s,i)=>e[s]=i);for(const s of n)delete e[s]}clone(){return new Pe(_s(this.value))}}function wd(r){const e=[];return Bt(r.fields,(t,n)=>{const s=new le([t]);if(Fi(n)){const i=wd(n.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new je(e)}class ue{constructor(e,t,n,s,i,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=u}static newInvalidDocument(e){return new ue(e,0,G.min(),G.min(),G.min(),Pe.empty(),0)}static newFoundDocument(e,t,n,s){return new ue(e,1,t,G.min(),n,s,0)}static newNoDocument(e,t){return new ue(e,2,t,G.min(),G.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new ue(e,3,t,G.min(),G.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ue&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ue(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zt{constructor(e,t){this.position=e,this.inclusive=t}}function bd(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],o=r.position[s];if(n=i.field.isKeyField()?O.comparator(O.fromName(o.referenceValue),t.key):Gt(o,t.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function Rd(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!lt(r.position[t],e.position[t]))return!1;return!0}class gs{constructor(e,t="asc"){this.field=e,this.dir=t}}function UI(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Sd{}class J extends Sd{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new BI(e,t,n):"array-contains"===t?new GI(e,n):"in"===t?new Nd(e,n):"not-in"===t?new zI(e,n):"array-contains-any"===t?new $I(e,n):new J(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new qI(e,n):new jI(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Gt(t,this.value)):null!==t&&jt(this.value)===jt(t)&&this.matchesComparison(Gt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return B(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class re extends Sd{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new re(e,t)}matches(e){return dr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function dr(r){return"and"===r.op}function qa(r){return function Pd(r){for(const e of r.filters)if(e instanceof re)return!1;return!0}(r)&&dr(r)}function ja(r){if(r instanceof J)return r.field.canonicalString()+r.op.toString()+hr(r.value);if(qa(r))return r.filters.map(e=>ja(e)).join(",");{const e=r.filters.map(t=>ja(t)).join(",");return`${r.op}(${e})`}}function Vd(r,e){return r instanceof J?(n=r,(s=e)instanceof J&&n.op===s.op&&n.field.isEqual(s.field)&&lt(n.value,s.value)):r instanceof re?function(n,s){return s instanceof re&&n.op===s.op&&n.filters.length===s.filters.length&&n.filters.reduce((i,o,u)=>i&&Vd(o,s.filters[u]),!0)}(r,e):void B(19439);var n,s}function xd(r){return r instanceof J?`${(t=r).field.canonicalString()} ${t.op} ${hr(t.value)}`:r instanceof re?function(t){return t.op.toString()+" {"+t.getFilters().map(xd).join(" ,")+"}"}(r):"Filter";var t}class BI extends J{constructor(e,t,n){super(e,t,n),this.key=O.fromName(n.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class qI extends J{constructor(e,t){super(e,"in",t),this.keys=Dd(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class jI extends J{constructor(e,t){super(e,"not-in",t),this.keys=Dd(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Dd(r,e){return(e.arrayValue?.values||[]).map(t=>O.fromName(t.referenceValue))}class GI extends J{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ms(t)&&ps(t.arrayValue,this.value)}}class Nd extends J{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ps(this.value.arrayValue,t)}}class zI extends J{constructor(e,t){super(e,"not-in",t)}matches(e){if(ps(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!ps(this.value.arrayValue,t)}}class $I extends J{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ms(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>ps(this.value.arrayValue,n))}}class KI{constructor(e,t=null,n=[],s=[],i=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=u,this.Te=null}}function Ga(r,e=null,t=[],n=[],s=null,i=null,o=null){return new KI(r,e,t,n,s,i,o)}function bn(r){const e=M(r);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>ja(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(i=n).field.canonicalString()+i.dir;var i}).join(","),ss(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>hr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>hr(n)).join(",")),e.Te=t}return e.Te}function ys(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!UI(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Vd(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Rd(r.startAt,e.startAt)&&Rd(r.endAt,e.endAt)}function Ui(r){return O.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class vt{constructor(e,t=null,n=[],s=[],i=null,o="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null}}function fr(r){return new vt(r)}function Fd(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function pr(r){const e=M(r);if(null===e.Ie){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new ne(le.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new gs(i,n))}),t.has(le.keyField().canonicalString())||e.Ie.push(new gs(le.keyField(),n))}return e.Ie}function xe(r){const e=M(r);return e.Ee||(e.Ee=function Ud(r,e){if("F"===r.limitType)return Ga(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>new gs(s.field,"desc"===s.dir?"asc":"desc"));const t=r.endAt?new zt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new zt(r.startAt.position,r.startAt.inclusive):null;return Ga(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,pr(r))),e.Ee}function qi(r,e,t){return new vt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Is(r,e){return ys(xe(r),xe(e))&&r.limitType===e.limitType}function Bd(r){return`${bn(xe(r))}|lt:${r.limitType}`}function mr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>xd(s)).join(", ")}]`),ss(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>{return`${(o=s).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>hr(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>hr(s)).join(",")),`Target(${n})`}(xe(r))}; limitType=${r.limitType})`}function Ts(r,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return null!==n.collectionGroup?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):O.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,s){for(const i of pr(n))if(!i.field.isKeyField()&&null===s.data.field(i.field))return!1;return!0}(r,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,e)&&(s=e,!((n=r).startAt&&!function(o,u,c){const h=bd(o,u,c);return o.inclusive?h<=0:h<0}(n.startAt,pr(n),s)||n.endAt&&!function(o,u,c){const h=bd(o,u,c);return o.inclusive?h>=0:h>0}(n.endAt,pr(n),s)));var n,s}function jd(r){return(e,t)=>{let n=!1;for(const s of pr(r)){const i=HI(s,e,t);if(0!==i)return i;n=n||s.field.isKeyField()}return 0}}function HI(r,e,t){const n=r.field.isKeyField()?O.comparator(e.key,t.key):function(i,o,u){const c=o.data.field(i),h=u.data.field(i);return null!==c&&null!==h?Gt(c,h):B(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return B(19790,{direction:r.dir})}}class wt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,i]of n)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Bt(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return ud(this.inner)}size(){return this.innerSize}}const WI=new ae(O.comparator);function Ge(){return WI}const Gd=new ae(O.comparator);function Es(...r){let e=Gd;for(const t of r)e=e.insert(t.key,t);return e}function zd(r){let e=Gd;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function ht(){return As()}function $d(){return As()}function As(){return new wt(r=>r.toString(),(r,e)=>r.isEqual(e))}const QI=new ae(O.comparator),XI=new ne(O.comparator);function K(...r){let e=XI;for(const t of r)e=e.add(t);return e}const JI=new ne($);function Ha(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:is(e)?"-0":e}}function Kd(r){return{integerValue:""+r}}function Hd(r,e){return function Kh(r){return"number"==typeof r&&Number.isInteger(r)&&!is(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?Kd(e):Ha(r,e)}class ji{constructor(){this._=void 0}}function YI(r,e,t){return r instanceof _r?function(s,i){const o={fields:{[dd]:{stringValue:hd},[pd]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ni(i)&&(i=ki(i)),i&&(o.fields[fd]=i),{mapValue:o}}(t,e):r instanceof Rn?Qd(r,e):r instanceof Sn?Xd(r,e):function(s,i){const o=Wd(s,i),u=Jd(o)+Jd(s.Ae);return Ua(o)&&Ua(s.Ae)?Kd(u):Ha(s.serializer,u)}(r,e)}function ZI(r,e,t){return r instanceof Rn?Qd(r,e):r instanceof Sn?Xd(r,e):t}function Wd(r,e){return r instanceof gr?Ua(n=e)||(i=n)&&"doubleValue"in i?e:{integerValue:0}:null;var n,i}class _r extends ji{}class Rn extends ji{constructor(e){super(),this.elements=e}}function Qd(r,e){const t=Yd(e);for(const n of r.elements)t.some(s=>lt(s,n))||t.push(n);return{arrayValue:{values:t}}}class Sn extends ji{constructor(e){super(),this.elements=e}}function Xd(r,e){let t=Yd(e);for(const n of r.elements)t=t.filter(s=>!lt(s,n));return{arrayValue:{values:t}}}class gr extends ji{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Jd(r){return he(r.integerValue||r.doubleValue)}function Yd(r){return ms(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class tT{constructor(e,t){this.version=e,this.transformResults=t}}class de{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new de}static exists(e){return new de(void 0,e)}static updateTime(e){return new de(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Gi(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class zi{}function Zd(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Ir(r.key,de.none()):new yr(r.key,r.data,de.none());{const t=r.data,n=Pe.empty();let s=new ne(le.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?n.delete(i):n.set(i,o),s=s.add(i)}return new bt(r.key,n,new je(s.toArray()),de.none())}}function nT(r,e,t){r instanceof yr?function(s,i,o){const u=s.value.clone(),c=nf(s.fieldTransforms,i,o.transformResults);u.setAll(c),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof bt?function(s,i,o){if(!Gi(s.precondition,i))return void i.convertToUnknownDocument(o.version);const u=nf(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(tf(s)),c.setAll(u),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function ws(r,e,t,n){return r instanceof yr?function(i,o,u,c){if(!Gi(i.precondition,o))return u;const h=i.value.clone(),f=rf(i.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof bt?function(i,o,u,c){if(!Gi(i.precondition,o))return u;const h=rf(i.fieldTransforms,c,o),f=o.data;return f.setAll(tf(i)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(r,e,t,n):(u=t,Gi(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function rT(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=Wd(n.transform,s||null);null!=i&&(null===t&&(t=Pe.empty()),t.set(n.field,i))}return t||null}function ef(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===s||n&&s&&er(n,s,(i,o)=>function eT(r,e){return r.field.isEqual(e.field)&&(s=e.transform,(n=r.transform)instanceof Rn&&s instanceof Rn||n instanceof Sn&&s instanceof Sn?er(n.elements,s.elements,lt):n instanceof gr&&s instanceof gr?lt(n.Ae,s.Ae):n instanceof _r&&s instanceof _r);var n,s}(i,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,s}class yr extends zi{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class bt extends zi{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function tf(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function nf(r,e,t){const n=new Map;j(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let s=0;s<t.length;s++){const i=r[s],o=i.transform,u=e.data.field(i.field);n.set(i.field,ZI(o,u,t[s]))}return n}function rf(r,e,t){const n=new Map;for(const s of r){const i=s.transform,o=t.data.field(s.field);n.set(s.field,YI(i,o,e))}return n}class Ir extends zi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wa extends zi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Qa{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&nT(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=$d();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let u=this.applyToLocalView(o,i.mutatedFields);u=t.has(s.key)?null:u;const c=Zd(o,u);null!==c&&n.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(G.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),K())}isEqual(e){return this.batchId===e.batchId&&er(this.mutations,e.mutations,(t,n)=>ef(t,n))&&er(this.baseMutations,e.baseMutations,(t,n)=>ef(t,n))}}class Xa{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){j(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let s=function(){return QI}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new Xa(e,t,n,s)}}class Ja{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class sT{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ee,Z;function af(r){if(void 0===r)return ye("GRPC error has no .code"),S.UNKNOWN;switch(r){case Ee.OK:return S.OK;case Ee.CANCELLED:return S.CANCELLED;case Ee.UNKNOWN:return S.UNKNOWN;case Ee.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Ee.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Ee.INTERNAL:return S.INTERNAL;case Ee.UNAVAILABLE:return S.UNAVAILABLE;case Ee.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Ee.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Ee.NOT_FOUND:return S.NOT_FOUND;case Ee.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Ee.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Ee.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Ee.ABORTED:return S.ABORTED;case Ee.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Ee.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Ee.DATA_LOSS:return S.DATA_LOSS;default:return B(39323,{code:r})}}(Z=Ee||(Ee={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";const iT=new Ot([4294967295,4294967295],0);function cf(r){const e=function uf(){return new TextEncoder}().encode(r),t=new vh;return t.update(e),new Uint8Array(t.digest())}function lf(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ot([t,n],0),new Ot([s,i],0)]}class Za{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new bs(`Invalid padding: ${t}`);if(n<0)throw new bs(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new bs(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new bs(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ot.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(Ot.fromNumber(n)));return 1===s.compare(iT)&&(s=new Ot([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=cf(e),[n,s]=lf(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(n,s,i);if(!this.we(o))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Za(i,s,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(0===this.ge)return;const t=cf(e),[n,s]=lf(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(n,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class bs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Rs{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,Ss.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Rs(G.min(),s,new ae($),Ge(),K())}}class Ss{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ss(n,t,K(),K(),K())}}class $i{constructor(e,t,n,s){this.be=e,this.removedTargetIds=t,this.key=n,this.De=s}}class hf{constructor(e,t){this.targetId=e,this.Ce=t}}class df{constructor(e,t,n=_e.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class ff{constructor(){this.ve=0,this.Fe=pf(),this.Me=_e.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=K(),t=K(),n=K();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:B(38017,{changeType:i})}}),new Ss(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=pf()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,j(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class oT{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ge(),this.Je=Ki(),this.He=Ki(),this.Ye=new ae($)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:B(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((n,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,n=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Ui(i))if(0===n){const o=new O(i.path);this.et(t,o,ue.newNoDocument(o,G.min()))}else j(1===n,20013,{expectedCount:n});else{const o=this._t(t);if(o!==n){const u=this.ut(e),c=u?this.ct(u,e,o):1;0!==c&&(this.it(t),this.Ye=this.Ye.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let o,u;try{o=At(n).toUint8Array()}catch(c){if(c instanceof ld)return et("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Za(o,s,i)}catch(c){return et(c instanceof bs?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.ge?null:u}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let s=0;return n.forEach(i=>{const o=this.Ge.ht(),u=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(u)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const u=this.ot(o);if(u){if(i.current&&Ui(u.target)){const c=new O(u.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,ue.newNoDocument(c,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let n=K();this.He.forEach((i,o)=>{let u=!0;o.forEachWhile(c=>{const h=this.ot(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Rs(e,t,this.Ye,this.je,n);return this.je=Ge(),this.Je=Ki(),this.He=Ki(),this.Ye=new ae($),s}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ff,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ne($),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ne($),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||k("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ff),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ki(){return new ae(O.comparator)}function pf(){return new ae(O.comparator)}const aT={asc:"ASCENDING",desc:"DESCENDING"},uT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},cT={and:"AND",or:"OR"};class lT{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function eu(r,e){return r.useProto3Json||ss(e)?e:{value:e}}function Tr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mf(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function hT(r,e){return Tr(r,e.toTimestamp())}function Ie(r){return j(!!r,49232),G.fromTimestamp(function(t){const n=Et(t);return new te(n.seconds,n.nanos)}(r))}function tu(r,e){return nu(r,e).canonicalString()}function nu(r,e){const t=(s=r,new H(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===e?t:t.child(e)}function _f(r){const e=H.fromString(r);return j(Rf(e),10190,{key:e.toString()}),e}function Ps(r,e){return tu(r.databaseId,e.path)}function dt(r,e){const t=_f(e);if(t.get(1)!==r.databaseId.projectId)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new O(If(t))}function gf(r,e){return tu(r.databaseId,e)}function ru(r){return new H(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function If(r){return j(r.length>4&&"documents"===r.get(4),29091,{key:r.toString()}),r.popFirst(5)}function Tf(r,e,t){return{name:Ps(r,e),fields:t.value.mapValue.fields}}function Ef(r,e){return{documents:[gf(r,e.path)]}}function Wi(r,e){const t={structuredQuery:{}},n=e.path;let s;null!==e.collectionGroup?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=gf(r,s);const i=function(h){if(0!==h.length)return bf(re.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(h){if(0!==h.length)return h.map(f=>{return{field:$t((_=f).field),direction:_T(_.dir)};var _})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=eu(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{ft:t,parent:s};var h}function vf(r){let e=function yf(r){const e=_f(r);return 4===e.length?H.emptyPath():If(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){j(1===n,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=function(p){const _=wf(p);return _ instanceof re&&qa(_)?_.getFilters():[_]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(_=>{return new gs(Er((R=_).field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(R.direction));var R}));let u=null;t.limit&&(u=function(p){let _;return _="object"==typeof p?p.value:p,ss(_)?null:_}(t.limit));let c=null;var p;t.startAt&&(c=new zt((p=t.startAt).values||[],!!p.before));let h=null;return t.endAt&&(h=function(p){return new zt(p.values||[],!p.before)}(t.endAt)),function Md(r,e,t,n,s,i,o,u){return new vt(r,e,t,n,s,i,o,u)}(e,s,o,i,u,"F",c,h)}function wf(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Er(t.unaryFilter.field);return J.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Er(t.unaryFilter.field);return J.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Er(t.unaryFilter.field);return J.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Er(t.unaryFilter.field);return J.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B(61313);default:return B(60726)}}(r):void 0!==r.fieldFilter?J.create(Er((t=r).fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B(58110);default:return B(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return re.create(t.compositeFilter.filters.map(n=>wf(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return B(1026)}}(t.compositeFilter.op))}(r):B(30097,{filter:r});var t}function _T(r){return aT[r]}function gT(r){return uT[r]}function yT(r){return cT[r]}function $t(r){return{fieldPath:r.canonicalString()}}function Er(r){return le.fromServerFormat(r.fieldPath)}function bf(r){return r instanceof J?function(t){if("=="===t.op){if(Id(t.value))return{unaryFilter:{field:$t(t.field),op:"IS_NAN"}};if(yd(t.value))return{unaryFilter:{field:$t(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Id(t.value))return{unaryFilter:{field:$t(t.field),op:"IS_NOT_NAN"}};if(yd(t.value))return{unaryFilter:{field:$t(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$t(t.field),op:gT(t.op),value:t.value}}}(r):r instanceof re?function(t){const n=t.getFilters().map(s=>bf(s));return 1===n.length?n[0]:{compositeFilter:{op:yT(t.op),filters:n}}}(r):B(54877,{filter:r})}function IT(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Rf(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class Rt{constructor(e,t,n,s,i=G.min(),o=G.min(),u=_e.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new Rt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Sf{constructor(e){this.yt=e}}function Xi(r){const e=vf({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?qi(e,e.limit,"L"):e}class xn{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(he(e.integerValue));else if("doubleValue"in e){const n=he(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),is(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=Et(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(At(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?Td(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Li(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):B(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const s of Object.keys(n))this.Ot(s,t),this.Ct(n[s],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const s=lr,i=n[s].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(he(i)),this.Ot(s,t),this.Ct(n[s],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const s of n)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),O.fromName(e).path.forEach(n=>{this.Ft(t,60),this.Ut(n,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}xn.Kt=new xn;class PT{constructor(){this.Cn=new lu}addToCollectionParentIndex(e,t){return this.Cn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(He.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(He.min())}updateCollectionGroup(e,t,n){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class lu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new ne(H.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new ne(H.comparator)).toArray()}}new Uint8Array(0);const zf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class De{static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(41943040,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class Nn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Nn(0)}static cr(){return new Nn(-1)}}const Xf="LruGarbageCollector";function Yf([r,e],[t,n]){const s=$(r,t);return 0===s?$(e,n):s}class xT{constructor(e){this.Ir=e,this.buffer=new ne(Yf),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Yf(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zf{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){var t=this;k(Xf,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,N.A)(function*(){t.Rr=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){Lt(n)?k(Xf,"Ignoring IndexedDB error during garbage collection: ",n):yield Ft(n)}yield t.Vr(3e5)}))}}class DT{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return b.resolve(Qe.ce);const n=new xT(t);return this.mr.forEachTarget(e,s=>n.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>n.Ar(s))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(zf)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zf):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,s,i,o,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,o=Date.now(),this.nthSequenceNumber(e,s))).next(p=>(n=p,u=Date.now(),this.removeTargets(e,n,t))).next(p=>(i=p,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(h=Date.now(),Zn()<=Y.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-f}ms\n\tDetermined least recently used ${s} in `+(u-o)+`ms\n\tRemoved ${i} targets in `+(c-u)+`ms\n\tRemoved ${p} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p})))}}class tp{constructor(){this.changes=new wt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ue.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?b.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class MT{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class op{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==n&&ws(n.mutation,s,je.empty(),te.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,K()).next(()=>n))}getLocalViewOfDocuments(e,t,n=K()){const s=ht();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(i=>{let o=Es();return i.forEach((u,c)=>{o=o.insert(u,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=ht();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,K()))}populateOverlays(e,t,n){const s=[];return n.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,s){let i=Ge();const o=As(),u=As();return t.forEach((c,h)=>{const f=n.get(h.key);s.has(h.key)&&(void 0===f||f.mutation instanceof bt)?i=i.insert(h.key,h):void 0!==f?(o.set(h.key,f.mutation.getFieldMask()),ws(f.mutation,h,f.mutation.getFieldMask(),te.now())):o.set(h.key,je.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>u.set(h,new MT(f,o.get(h)??null))),u))}recalculateAndSaveOverlays(e,t){const n=As();let s=new ae((o,u)=>o-u),i=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||je.empty();f=u.applyToLocalView(h,f),n.set(c,f);const p=(s.get(u.batchId)||K()).add(c);s=s.insert(u.batchId,p)})}).next(()=>{const o=[],u=s.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,p=$d();f.forEach(_=>{if(!i.has(_)){const T=Zd(t.get(_),n.get(_));null!==T&&p.set(_,T),i=i.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return b.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return O.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function za(r){return null!==r.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var o}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):b.resolve(ht());let u=-1,c=i;return o.next(h=>b.forEach(h,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),i.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,c,h,K())).next(f=>({batchId:u,changes:zd(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(n=>{let s=Es();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let o=Es();return this.indexManager.getCollectionParents(e,i).next(u=>b.forEach(u,c=>{const h=(p=t,_=c.child(i),new vt(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));var p,_;return this.getDocumentsMatchingCollectionQuery(e,h,n,s).next(f=>{f.forEach((p,_)=>{o=o.insert(p,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(o=>{i.forEach((c,h)=>{const f=h.getKey();null===o.get(f)&&(o=o.insert(f,ue.newInvalidDocument(f)))});let u=Es();return o.forEach((c,h)=>{const f=i.get(c);void 0!==f&&ws(f.mutation,h,je.empty(),te.now()),Ts(t,h)&&(u=u.insert(c,h))}),u})}}class FT{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return b.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(s=t).id,version:s.version,createTime:Ie(s.createTime)}),b.resolve();var s}getNamedQuery(e,t){return b.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(s=t).name,query:Xi(s.bundledQuery),readTime:Ie(s.readTime)}),b.resolve();var s}}class LT{constructor(){this.overlays=new ae(O.comparator),this.qr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ht();return b.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,i)=>{this.St(e,t,i)}),b.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.qr.get(n);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(n)),b.resolve()}getOverlaysForCollection(e,t,n){const s=ht(),i=t.length+1,o=new O(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&c.largestBatchId>n&&s.set(c.getKey(),c)}return b.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new ae((h,f)=>h-f);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=i.get(h.largestBatchId);null===f&&(f=ht(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=ht(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=s)););return b.resolve(u)}St(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const o=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Ja(t,n));let i=this.qr.get(t);void 0===i&&(i=K(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class UT{constructor(){this.sessionToken=_e.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}class hu{constructor(){this.Qr=new ne(be.$r),this.Ur=new ne(be.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new be(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Gr(new be(e,t))}zr(e,t){e.forEach(n=>this.removeReference(n,t))}jr(e){const t=new O(new H([])),n=new be(t,e),s=new be(t,e+1),i=[];return this.Ur.forEachInRange([n,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new O(new H([])),n=new be(t,e),s=new be(t,e+1);let i=K();return this.Ur.forEachInRange([n,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new be(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class be{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return O.comparator(e.key,t.key)||$(e.Yr,t.Yr)}static Kr(e,t){return $(e.Yr,t.Yr)||O.comparator(e.key,t.key)}}class BT{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ne(be.$r)}checkEmpty(e){return b.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.tr;this.tr++;const o=new Qa(i,t,n,s);this.mutationQueue.push(o);for(const u of s)this.Zr=this.Zr.add(new be(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.ei(t+1),i=s<0?0:s;return b.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(0===this.mutationQueue.length?Ut:this.tr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new be(t,0),s=new be(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],o=>{const u=this.Xr(o.Yr);i.push(u)}),b.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne($);return t.forEach(s=>{const i=new be(s,0),o=new be(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],u=>{n=n.add(u.Yr)})}),b.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;O.isDocumentKey(i)||(i=i.child(""));const o=new be(new O(i),0);let u=new ne($);return this.Zr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===s&&(u=u.add(c.Yr)),!0)},o),b.resolve(this.ti(u))}ti(e){const t=[];return e.forEach(n=>{const s=this.Xr(n);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){j(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return b.forEach(t.mutations,s=>{const i=new be(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new be(t,0),s=this.Zr.firstAfterOrEqual(n);return b.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return b.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class qT{constructor(e){this.ri=e,this.docs=new ae(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return b.resolve(n?n.document.mutableCopy():ue.newInvalidDocument(t))}getEntries(e,t){let n=Ge();return t.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():ue.newInvalidDocument(s))}),b.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=Ge();const o=t.path,u=new O(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||ba(new He((r=f).readTime,r.key,-1),n)<=0||(s.has(f.key)||Ts(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}var r;return b.resolve(i)}getAllFromCollectionGroup(e,t,n,s){B(9500)}ii(e,t){return b.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new jT(this)}getSize(e){return b.resolve(this.size)}}class jT extends tp{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(n)}),b.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class GT{constructor(e){this.persistence=e,this.si=new wt(t=>bn(t),ys),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.oi=0,this._i=new hu,this.targetCount=0,this.ai=Nn.ur()}forEachTarget(e,t){return this.si.forEach((n,s)=>t(s)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),b.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Nn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Pr(t),b.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.si.forEach((o,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),b.waitFor(i).next(()=>s)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return b.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),b.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),b.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return b.resolve(n)}containsKey(e,t){return b.resolve(this._i.containsKey(t))}}class du{constructor(e,t){this.ui={},this.overlays={},this.ci=new Qe(0),this.li=!1,this.li=!0,this.hi=new UT,this.referenceDelegate=e(this),this.Pi=new GT(this),this.indexManager=new PT,this.remoteDocumentCache=new qT(n=>this.referenceDelegate.Ti(n)),this.serializer=new Sf(t),this.Ii=new FT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new LT,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new BT(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);const s=new zT(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return b.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class zT extends Gh{constructor(e){super(),this.currentSequenceNumber=e}}class so{constructor(e){this.persistence=e,this.Ri=new hu,this.Vi=null}static mi(e){return new so(e)}get fi(){if(this.Vi)return this.Vi;throw B(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),b.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,n=>{const s=O.fromPath(n);return this.gi(e,s).next(i=>{i||t.removeEntry(s,G.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class io{constructor(e,t){this.persistence=e,this.pi=new wt(n=>function Ce(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Hh(e)),e=cI(r.get(t),e);return Hh(e)}(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=function ep(r,e){return new DT(r,e)}(this,t)}static mi(e,t){return new io(e,t)}Ei(){}di(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(s=>n+s))}wr(e){let t=0;return this.pr(e,n=>{t++}).next(()=>t)}pr(e,t){return b.forEach(this.pi,(n,s)=>this.br(e,n,s).next(i=>i?b.resolve():t(s)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(u=>{u||(n++,i.removeEntry(o,G.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),b.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Mi(e.data.value)),t}br(e,t,n){return b.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return b.resolve(void 0!==s&&s>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class yu{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=s}static As(e,t){let n=K(),s=K();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new yu(e,t.fromCache,n,s)}}class KT{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class cp{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=Ql()?8:function zh(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}(function Nt(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new KT;return this.Ss(e,t,o).next(u=>{if(i.result=u,this.Vs)return this.bs(e,t,o,u.size)})}).next(()=>i.result)}bs(e,t,n,s){return n.documentReadCount<this.fs?(Zn()<=Y.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",mr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(Zn()<=Y.DEBUG&&k("QueryEngine","Query:",mr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Zn()<=Y.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",mr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xe(t))):b.resolve())}ys(e,t){if(Fd(t))return b.resolve(null);let n=xe(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=qi(t,null,"F"),n=xe(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=K(...i);return this.ps.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.Ds(t,u);return this.Cs(t,h,o,c.readTime)?this.ys(e,qi(t,null,"F")):this.vs(e,h,t,c)}))})))}ws(e,t,n,s){return Fd(t)||s.isEqual(G.min())?b.resolve(null):this.ps.getDocuments(e,n).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,n,s)?b.resolve(null):(Zn()<=Y.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),mr(t)),this.vs(e,o,t,function Bh(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=G.fromTimestamp(1e9===n?new te(t+1,0):new te(t,n));return new He(s,O.empty(),e)}(s,-1)).next(u=>u))})}Ds(e,t){let n=new ne(jd(e));return t.forEach((s,i)=>{Ts(e,i)&&(n=n.add(i))}),n}Cs(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,n){return Zn()<=Y.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",mr(t)),this.ps.getDocumentsMatchingQuery(e,t,He.min(),n)}vs(e,t,n,s){return this.ps.getDocumentsMatchingQuery(e,n,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}const Iu="LocalStore",HT=3e8;class WT{constructor(e,t,n,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new ae($),this.xs=new wt(i=>bn(i),ys),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new op(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function hp(r,e){return Tu.apply(this,arguments)}function Tu(){return(Tu=(0,N.A)(function*(r,e){const t=M(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],u=[];let c=K();for(const h of s){o.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of i){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({Ls:h,removedBatchIds:o,addedBatchIds:u}))})})})).apply(this,arguments)}function dp(r){const e=M(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function JT(r,e){const t=M(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=Ut),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Pr(r,e,t){return Eu.apply(this,arguments)}function Eu(){return(Eu=(0,N.A)(function*(r,e,t){const n=M(r),s=n.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Lt(o))throw o;k(Iu,`Failed to update sequence numbers for target ${e}: ${o}`)}n.Ms=n.Ms.remove(e),n.xs.delete(s.target)})).apply(this,arguments)}function ao(r,e,t){const n=M(r);let s=G.min(),i=K();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,h,f){const p=M(c),_=p.xs.get(f);return void 0!==_?b.resolve(p.Ms.get(_)):p.Pi.getTargetData(h,f)}(n,o,xe(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(o,u.targetId).next(c=>{i=c})}).next(()=>n.Fs.getDocumentsMatchingQuery(o,e,t?s:G.min(),t?i:K())).next(u=>(function _p(r,e,t){let n=r.Os.get(e)||G.min();t.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.Os.set(e,n)}(n,function qd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),u),{documents:u,Qs:i})))}class Ru{constructor(){this.activeTargetIds=function Ka(){return JI}()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ap{constructor(){this.Mo=new Ru,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ru,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class eE{Oo(e){}shutdown(){}}const vp="ConnectivityMonitor";class wp{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){k(vp,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){k(vp,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lo=null;function Pu(){return null===lo?lo=268435456+Math.round(2147483648*Math.random()):lo++,"0x"+lo.toString(16)}const Vu="RestConnection",tE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class nE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===fs?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(e,t,n,s,i){const o=Pu(),u=this.zo(e,t.toUriEncodedString());k(Vu,`Sending RPC '${e}' ${o}:`,u,n);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:h}=new URL(u),f=_i(h);return this.Jo(e,u,c,n,f).then(p=>(k(Vu,`Received RPC '${e}' ${o}: `,p),p),p=>{throw et(Vu,`RPC '${e}' ${o} failed with error: `,p,"url: ",u,"request:",n),p})}Ho(e,t,n,s,i,o){return this.Go(e,t,n,s,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Yn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),n&&n.headers.forEach((s,i)=>e[i]=s)}zo(e,t){return`${this.Uo}/v1/${t}:${tE[e]}`}terminate(){}}class rE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ne="WebChannelConnection";class sE extends nE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,s,i){const o=Pu();return new Promise((u,c)=>{const h=new wh;h.setWithCredentials(!0),h.listenOnce(bh.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Ei.NO_ERROR:const p=h.getResponseJson();k(Ne,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),u(p);break;case Ei.TIMEOUT:k(Ne,`RPC '${e}' ${o} timed out`),c(new D(S.DEADLINE_EXCEEDED,"Request time out"));break;case Ei.HTTP_ERROR:const _=h.getStatus();if(k(Ne,`RPC '${e}' ${o} failed with status:`,_,"response text:",h.getResponseText()),_>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);const R=T?.error;if(R&&R.status&&R.message){const x=function(U){const q=U.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(q)>=0?q:S.UNKNOWN}(R.status);c(new D(x,R.message))}else c(new D(S.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new D(S.UNAVAILABLE,"Connection failed."));break;default:B(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{k(Ne,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(s);k(Ne,`RPC '${e}' ${o} sending request:`,s),h.send(t,"POST",f,n,15)})}T_(e,t,n){const s=Pu(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ph(),u=Sh(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=i.join("");k(Ne,`Creating RPC '${e}' stream ${s}: ${f}`,c);const p=o.createWebChannel(f,c);this.I_(p);let _=!1,T=!1;const R=new rE({Yo:C=>{T?k(Ne,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(_||(k(Ne,`Opening RPC '${e}' stream ${s} transport.`),p.open(),_=!0),k(Ne,`RPC '${e}' stream ${s} sending:`,C),p.send(C))},Zo:()=>p.close()}),x=(C,U,q)=>{C.listen(U,F=>{try{q(F)}catch(z){setTimeout(()=>{throw z},0)}})};return x(p,ts.EventType.OPEN,()=>{T||(k(Ne,`RPC '${e}' stream ${s} transport opened.`),R.o_())}),x(p,ts.EventType.CLOSE,()=>{T||(T=!0,k(Ne,`RPC '${e}' stream ${s} transport closed`),R.a_(),this.E_(p))}),x(p,ts.EventType.ERROR,C=>{T||(T=!0,et(Ne,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),R.a_(new D(S.UNAVAILABLE,"The operation could not be completed")))}),x(p,ts.EventType.MESSAGE,C=>{if(!T){const U=C.data[0];j(!!U,16349);const q=U,F=q?.error||q[0]?.error;if(F){k(Ne,`RPC '${e}' stream ${s} received error:`,F);const z=F.status;let X=function(g){const y=Ee[g];if(void 0!==y)return af(y)}(z),W=F.message;void 0===X&&(X=S.INTERNAL,W="Unknown error status: "+z+" with message "+F.message),T=!0,R.a_(new D(X,W)),p.close()}else k(Ne,`RPC '${e}' stream ${s} received:`,U),R.u_(U)}}),x(u,Rh.STAT_EVENT,C=>{C.stat===_a.PROXY?k(Ne,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===_a.NOPROXY&&k(Ne,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{R.__()},0),R}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function ho(){return typeof document<"u"?document:null}function On(r){return new lT(r,!0)}class Cu{constructor(e,t,n=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-n);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Rp="PersistentStream";class Sp{constructor(e,t,n,s,i,o,u,c){this.Mi=e,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Cu(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}stop(){var e=this;return(0,N.A)(function*(){e.x_()&&(yield e.close(0))})()}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){var e=this;return(0,N.A)(function*(){if(e.O_())return e.close(0)})()}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){var n=this;return(0,N.A)(function*(){n.Q_(),n.U_(),n.M_.cancel(),n.D_++,4!==e?n.M_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.M_.g_()):t&&t.code===S.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.K_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.r_(t)})()}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.D_===t&&this.G_(n,s)},n=>{e(()=>{const s=new D(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{n(()=>this.z_(s))}),this.stream.onMessage(s=>{n(()=>1==++this.F_?this.J_(s):this.onNext(s))})}N_(){var e=this;this.state=5,this.M_.p_((0,N.A)(function*(){e.state=0,e.start()}))}z_(e){return k(Rp,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(k(Rp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class iE extends Sp{constructor(e,t,n,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function fT(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:B(39313,{state:h}),s=e.targetChange.targetIds||[],i=function(h,f){return h.useProto3Json?(j(void 0===f||"string"==typeof f,58123),_e.fromBase64String(f||"")):(j(void 0===f||f instanceof Buffer||f instanceof Uint8Array,16193),_e.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(h){const f=void 0===h.code?S.UNKNOWN:af(h.code);return new D(f,h.message||"")}(o);t=new df(n,s,i,u||null)}else if("documentChange"in e){const n=e.documentChange,s=dt(r,n.document.name),i=Ie(n.document.updateTime),o=n.document.createTime?Ie(n.document.createTime):G.min(),u=new Pe({mapValue:{fields:n.document.fields}}),c=ue.newFoundDocument(s,i,o,u);t=new $i(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,s=dt(r,n.document),i=n.readTime?Ie(n.readTime):G.min(),o=ue.newNoDocument(s,i);t=new $i([],n.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const n=e.documentRemove,s=dt(r,n.document);t=new $i([],n.removedTargetIds||[],s,null)}else{if(!("filter"in e))return B(11601,{Rt:e});{const n=e.filter,{count:s=0,unchangedNames:i}=n,o=new sT(s,i);t=new hf(n.targetId,o)}}var h;return t}(this.serializer,e),n=function(i){if(!("targetChange"in i))return G.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?G.min():o.readTime?Ie(o.readTime):G.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=ru(this.serializer),t.addTarget=function(i,o){let u;const c=o.target;if(u=Ui(c)?{documents:Ef(i,c)}:{query:Wi(i,c).ft},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=mf(i,o.resumeToken);const h=eu(i,o.expectedCount);null!==h&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(G.min())>0){u.readTime=Tr(i,o.snapshotVersion.toTimestamp());const h=eu(i,o.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function mT(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B(28987,{purpose:s})}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=ru(this.serializer),t.removeTarget=e,this.q_(t)}}class oE extends Sp{constructor(e,t,n,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return j(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,j(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){j(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function pT(r,e){return r&&r.length>0?(j(void 0!==e,14353),r.map(t=>function(s,i){let o=Ie(s.updateTime?s.updateTime:i);return o.isEqual(G.min())&&(o=Ie(i)),new tT(o,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=ru(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Vs(r,e){let t;if(e instanceof yr)t={update:Tf(r,e.key,e.value)};else if(e instanceof Ir)t={delete:Ps(r,e.key)};else if(e instanceof bt)t={update:Tf(r,e.key,e.data),updateMask:IT(e.fieldMask)};else{if(!(e instanceof Wa))return B(16599,{Vt:e.type});t={verify:Ps(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const u=o.transform;if(u instanceof _r)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Rn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Sn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof gr)return{fieldPath:o.field.canonicalString(),increment:u.Ae};throw B(20930,{transform:o.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:hT(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:B(27497)),t;var i}(this.serializer,n))};this.q_(t)}}class aE{}class uE extends aE{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,nu(t,n),s,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new D(S.UNKNOWN,i.toString())})}Ho(e,t,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Ho(e,nu(t,n),s,o,u,i)).catch(o=>{throw"FirebaseError"===o.name?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(S.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class cE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ye(t),this.aa=!1):k("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Mn="RemoteStore";class lE{constructor(e,t,n,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(u=>{n.enqueueAndForget((0,N.A)(function*(){var c;Xt(o)&&(k(Mn,"Restarting streams for network reachability change."),yield(c=(0,N.A)(function*(f){const p=M(f);p.Ea.add(4),yield Vr(p),p.Ra.set("Unknown"),p.Ea.delete(4),yield Fs(p)}),function h(f){return c.apply(this,arguments)})(o))}))}),this.Ra=new cE(n,s)}}function Fs(r){return xu.apply(this,arguments)}function xu(){return(xu=(0,N.A)(function*(r){if(Xt(r))for(const e of r.da)yield e(!0)})).apply(this,arguments)}function Vr(r){return Du.apply(this,arguments)}function Du(){return(Du=(0,N.A)(function*(r){for(const e of r.da)yield e(!1)})).apply(this,arguments)}function fo(r,e){const t=M(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ou(t)?ku(t):Dr(t).O_()&&Nu(t,e))}function Cr(r,e){const t=M(r),n=Dr(t);t.Ia.delete(e),n.O_()&&Pp(t,e),0===t.Ia.size&&(n.O_()?n.L_():Xt(t)&&t.Ra.set("Unknown"))}function Nu(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Dr(r).Y_(e)}function Pp(r,e){r.Va.Ue(e),Dr(r).Z_(e)}function ku(r){r.Va=new oT({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),Dr(r).start(),r.Ra.ua()}function Ou(r){return Xt(r)&&!Dr(r).x_()&&r.Ia.size>0}function Xt(r){return 0===M(r).Ea.size}function Vp(r){r.Va=void 0}function hE(r){return Mu.apply(this,arguments)}function Mu(){return(Mu=(0,N.A)(function*(r){r.Ra.set("Online")})).apply(this,arguments)}function dE(r){return Fu.apply(this,arguments)}function Fu(){return(Fu=(0,N.A)(function*(r){r.Ia.forEach((e,t)=>{Nu(r,e)})})).apply(this,arguments)}function fE(r,e){return Lu.apply(this,arguments)}function Lu(){return(Lu=(0,N.A)(function*(r,e){Vp(r),Ou(r)?(r.Ra.ha(e),ku(r)):r.Ra.set("Unknown")})).apply(this,arguments)}function pE(r,e,t){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,N.A)(function*(r,e,t){if(r.Ra.set("Online"),e instanceof df&&2===e.state&&e.cause)try{yield(n=(0,N.A)(function*(i,o){const u=o.cause;for(const c of o.targetIds)i.Ia.has(c)&&(yield i.remoteSyncer.rejectListen(c,u),i.Ia.delete(c),i.Va.removeTarget(c))}),function s(i,o){return n.apply(this,arguments)})(r,e)}catch(n){k(Mn,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield po(r,n)}else if(e instanceof $i?r.Va.Ze(e):e instanceof hf?r.Va.st(e):r.Va.tt(e),!t.isEqual(G.min()))try{const n=yield dp(r.localStore);t.compareTo(n)>=0&&(yield function(i,o){const u=i.Va.Tt(o);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=i.Ia.get(h);f&&i.Ia.set(h,f.withResumeToken(c.resumeToken,o))}}),u.targetMismatches.forEach((c,h)=>{const f=i.Ia.get(c);if(!f)return;i.Ia.set(c,f.withResumeToken(_e.EMPTY_BYTE_STRING,f.snapshotVersion)),Pp(i,c);const p=new Rt(f.target,c,h,f.sequenceNumber);Nu(i,p)}),i.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){k(Mn,"Failed to raise snapshot:",n),yield po(r,n)}var n}),Uu.apply(this,arguments)}function po(r,e,t){return Bu.apply(this,arguments)}function Bu(){return(Bu=(0,N.A)(function*(r,e,t){if(!Lt(e))throw e;r.Ea.add(1),yield Vr(r),r.Ra.set("Offline"),t||(t=()=>dp(r.localStore)),r.asyncQueue.enqueueRetryable((0,N.A)(function*(){k(Mn,"Retrying IndexedDB access"),yield t(),r.Ea.delete(1),yield Fs(r)}))})).apply(this,arguments)}function Cp(r,e){return e().catch(t=>po(r,t,e))}function xr(r){return qu.apply(this,arguments)}function qu(){return(qu=(0,N.A)(function*(r){const e=M(r),t=Jt(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ut;for(;mE(e);)try{const s=yield JT(e.localStore,n);if(null===s){0===e.Ta.length&&t.L_();break}n=s.batchId,_E(e,s)}catch(s){yield po(e,s)}xp(e)&&Dp(e)})).apply(this,arguments)}function mE(r){return Xt(r)&&r.Ta.length<10}function _E(r,e){r.Ta.push(e);const t=Jt(r);t.O_()&&t.X_&&t.ea(e.mutations)}function xp(r){return Xt(r)&&!Jt(r).x_()&&r.Ta.length>0}function Dp(r){Jt(r).start()}function gE(r){return ju.apply(this,arguments)}function ju(){return(ju=(0,N.A)(function*(r){Jt(r).ra()})).apply(this,arguments)}function yE(r){return Gu.apply(this,arguments)}function Gu(){return(Gu=(0,N.A)(function*(r){const e=Jt(r);for(const t of r.Ta)e.ea(t.mutations)})).apply(this,arguments)}function IE(r,e,t){return zu.apply(this,arguments)}function zu(){return(zu=(0,N.A)(function*(r,e,t){const n=r.Ta.shift(),s=Xa.from(n,e,t);yield Cp(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield xr(r)})).apply(this,arguments)}function TE(r,e){return $u.apply(this,arguments)}function $u(){return $u=(0,N.A)(function*(r,e){var t;e&&Jt(r).X_&&(yield(t=(0,N.A)(function*(s,i){if(function of(r){switch(r){case S.OK:return B(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return B(15467,{code:r})}}(u=i.code)&&u!==S.ABORTED){const o=s.Ta.shift();Jt(s).B_(),yield Cp(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield xr(s)}var u}),function n(s,i){return t.apply(this,arguments)})(r,e)),xp(r)&&Dp(r)}),$u.apply(this,arguments)}function Np(r,e){return Ku.apply(this,arguments)}function Ku(){return(Ku=(0,N.A)(function*(r,e){const t=M(r);t.asyncQueue.verifyOperationInProgress(),k(Mn,"RemoteStore received new credentials");const n=Xt(t);t.Ea.add(3),yield Vr(t),n&&t.Ra.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield Fs(t)})).apply(this,arguments)}function Hu(r,e){return Wu.apply(this,arguments)}function Wu(){return(Wu=(0,N.A)(function*(r,e){const t=M(r);e?(t.Ea.delete(2),yield Fs(t)):e||(t.Ea.add(2),yield Vr(t),t.Ra.set("Unknown"))})).apply(this,arguments)}function Dr(r){return r.ma||(r.ma=function(t,n,s){const i=M(t);return i.sa(),new iE(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:hE.bind(null,r),t_:dE.bind(null,r),r_:fE.bind(null,r),H_:pE.bind(null,r)}),r.da.push(function(){var e=(0,N.A)(function*(t){t?(r.ma.B_(),Ou(r)?ku(r):r.Ra.set("Unknown")):(yield r.ma.stop(),Vp(r))});return function(t){return e.apply(this,arguments)}}())),r.ma}function Jt(r){return r.fa||(r.fa=function(t,n,s){const i=M(t);return i.sa(),new oE(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:gE.bind(null,r),r_:TE.bind(null,r),ta:yE.bind(null,r),na:IE.bind(null,r)}),r.da.push(function(){var e=(0,N.A)(function*(t){t?(r.fa.B_(),yield xr(r)):(yield r.fa.stop(),r.Ta.length>0&&(k(Mn,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))});return function(t){return e.apply(this,arguments)}}())),r.fa}class Qu{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new we,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const o=Date.now()+n,u=new Qu(e,t,o,s,i);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new D(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Nr(r,e){if(ye("AsyncQueue",`${e}: ${r}`),Lt(r))return new D(S.UNAVAILABLE,`${e}: ${r}`);throw r}class Fn{static emptySet(e){return new Fn(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||O.comparator(t.key,n.key):(t,n)=>O.comparator(t.key,n.key),this.keyedMap=Es(),this.sortedSet=new ae(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Fn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Fn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class kp{constructor(){this.ga=new ae(O.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):B(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Ln{constructor(e,t,n,s,i,o,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,s,i){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new Ln(e,t,Fn.emptySet(t),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Is(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class EE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class AE{constructor(){this.queries=Op(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,n){const s=M(t),i=s.queries;s.queries=Op(),i.forEach((o,u)=>{for(const c of u.Sa)c.onError(n)})}(this,new D(S.ABORTED,"Firestore shutting down"))}}function Op(){return new wt(r=>Bd(r),Is)}function Ju(){return(Ju=(0,N.A)(function*(r,e){const t=M(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(n=2):(i=new EE,n=e.Da()?0:1);try{switch(n){case 0:i.wa=yield t.onListen(s,!0);break;case 1:i.wa=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){const u=Nr(o,`Initialization of query '${mr(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&ec(t)})).apply(this,arguments)}function Zu(){return(Zu=(0,N.A)(function*(r,e){const t=M(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),0===i.Sa.length?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function vE(r,e){const t=M(r);let n=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const u of o.Sa)u.Fa(s)&&(n=!0);o.wa=s}}n&&ec(t)}function wE(r,e,t){const n=M(r),s=n.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);n.queries.delete(e)}function ec(r){r.Ca.forEach(e=>{e.next()})}var tc,Mp;(Mp=tc||(tc={})).Ma="default",Mp.Cache="cache";class nc{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)3!==s.type&&n.push(s);e=new Ln(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!e.fromCache||!this.Da()||(!this.options.qa||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}ka(e){e=Ln.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==tc.Cache}}class Bp{constructor(e){this.key=e}}class qp{constructor(e){this.key=e}}class jp{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=K(),this.mutatedKeys=K(),this.eu=jd(e),this.tu=new Fn(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new kp,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,u=!1;const c="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,h="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,p)=>{const _=s.get(f),T=Ts(this.query,p)?p:null,R=!!_&&this.mutatedKeys.has(_.key),x=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let C=!1;_&&T?_.data.isEqual(T.data)?R!==x&&(n.track({type:3,doc:T}),C=!0):this.su(_,T)||(n.track({type:2,doc:T}),C=!0,(c&&this.eu(T,c)>0||h&&this.eu(T,h)<0)&&(u=!0)):!_&&T?(n.track({type:0,doc:T}),C=!0):_&&!T&&(n.track({type:1,doc:_}),C=!0,(c||h)&&(u=!0)),C&&(T?(o=o.add(T),i=x?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const f="F"===this.query.limitType?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{tu:o,iu:n,Cs:u,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((f,p)=>function(T,R){const x=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B(20277,{Rt:C})}};return x(T)-x(R)}(f.type,p.type)||this.eu(f.doc,p.doc)),this.ou(n),s=s??!1;const u=t&&!s?this._u():[],c=0===this.Xa.size&&this.current&&!s?1:0,h=c!==this.Za;return this.Za=c,0!==o.length||h?{snapshot:new Ln(this.query,e.tu,i,o,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new kp,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=K(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});const t=[];return e.forEach(n=>{this.Xa.has(n)||t.push(new qp(n))}),this.Xa.forEach(n=>{e.has(n)||t.push(new Bp(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=K();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ln.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Yt="SyncEngine";class bE{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class RE{constructor(e){this.key=e,this.hu=!1}}class SE{constructor(e,t,n,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new wt(u=>Bd(u),Is),this.Iu=new Map,this.Eu=new Set,this.du=new ae(O.comparator),this.Au=new Map,this.Ru=new hu,this.Vu={},this.mu=new Map,this.fu=Nn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function PE(r,e){return sc.apply(this,arguments)}function sc(){return(sc=(0,N.A)(function*(r,e,t=!0){const n=mo(r);let s;const i=n.Tu.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=yield Gp(n,e,t,!0),s})).apply(this,arguments)}function VE(r,e){return ic.apply(this,arguments)}function ic(){return(ic=(0,N.A)(function*(r,e){const t=mo(r);yield Gp(t,e,!0,!1)})).apply(this,arguments)}function Gp(r,e,t,n){return oc.apply(this,arguments)}function oc(){return(oc=(0,N.A)(function*(r,e,t,n){const s=yield function Sr(r,e){const t=M(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Pi.getTargetData(n,e).next(i=>i?(s=i,b.resolve(s)):t.Pi.allocateTargetId(n).next(o=>(s=new Rt(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.Ms.get(n.targetId);return(null===s||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n})}(r.localStore,xe(e)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let u;return n&&(u=yield function ac(r,e,t,n,s){return uc.apply(this,arguments)}(r,e,i,"current"===o,s.resumeToken)),r.isPrimaryClient&&t&&fo(r.remoteStore,s),u})).apply(this,arguments)}function uc(){return uc=(0,N.A)(function*(r,e,t,n,s){r.pu=(p,_,T)=>{return(R=(0,N.A)(function*(C,U,q,F){let z=U.view.ru(q);z.Cs&&(z=yield ao(C.localStore,U.query,!1).then(({documents:g})=>U.view.ru(g,z)));const X=F&&F.targetChanges.get(U.targetId),W=F&&null!=F.targetMismatches.get(U.targetId),E=U.view.applyChanges(z,C.isPrimaryClient,X,W);return Ic(C,U.targetId,E.au),E.snapshot}),function x(C,U,q,F){return R.apply(this,arguments)})(r,p,_,T);var R};const i=yield ao(r.localStore,e,!0),o=new jp(e,i.Qs),u=o.ru(i.documents),c=Ss.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,s),h=o.applyChanges(u,r.isPrimaryClient,c);Ic(r,t,h.au);const f=new bE(e,t,o);return r.Tu.set(e,f),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),h.snapshot}),uc.apply(this,arguments)}function CE(r,e,t){return cc.apply(this,arguments)}function cc(){return(cc=(0,N.A)(function*(r,e,t){const n=M(r),s=n.Tu.get(e),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter(o=>!Is(o,e))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Pr(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Cr(n.remoteStore,s.targetId),kr(n,s.targetId)}).catch(Ft))):(kr(n,s.targetId),yield Pr(n.localStore,s.targetId,!0))})).apply(this,arguments)}function xE(r,e){return lc.apply(this,arguments)}function lc(){return(lc=(0,N.A)(function*(r,e){const t=M(r),n=t.Tu.get(e),s=t.Iu.get(n.targetId);t.isPrimaryClient&&1===s.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Cr(t.remoteStore,n.targetId))})).apply(this,arguments)}function hc(){return(hc=(0,N.A)(function*(r,e,t){const n=function Cc(r){const e=M(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=kE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=OE.bind(null,e),e}(r);try{const s=yield function(o,u){const c=M(o),h=te.now(),f=u.reduce((T,R)=>T.add(R.key),K());let p,_;return c.persistence.runTransaction("Locally write mutations","readwrite",T=>{let R=Ge(),x=K();return c.Ns.getEntries(T,f).next(C=>{R=C,R.forEach((U,q)=>{q.isValidDocument()||(x=x.add(U))})}).next(()=>c.localDocuments.getOverlayedDocuments(T,R)).next(C=>{p=C;const U=[];for(const q of u){const F=rT(q,p.get(q.key).overlayedDocument);null!=F&&U.push(new bt(q.key,F,wd(F.value.mapValue),de.exists(!0)))}return c.mutationQueue.addMutationBatch(T,h,U,u)}).next(C=>{_=C;const U=C.applyToLocalDocumentSet(p,x);return c.documentOverlayCache.saveOverlays(T,C.batchId,U)})}).then(()=>({batchId:_.batchId,changes:zd(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,u,c){let h=o.Vu[o.currentUser.toKey()];h||(h=new ae($)),h=h.insert(u,c),o.Vu[o.currentUser.toKey()]=h}(n,s.batchId,t),yield St(n,s.changes),yield xr(n.remoteStore)}catch(s){const i=Nr(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function zp(r,e){return dc.apply(this,arguments)}function dc(){return(dc=(0,N.A)(function*(r,e){const t=M(r);try{const n=yield function XT(r,e){const t=M(r),n=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const u=[];e.targetChanges.forEach((f,p)=>{const _=s.get(p);if(!_)return;u.push(t.Pi.removeMatchingKeys(i,f.removedDocuments,p).next(()=>t.Pi.addMatchingKeys(i,f.addedDocuments,p)));let T=_.withSequenceNumber(i.currentSequenceNumber);var x,C,U;null!==e.targetMismatches.get(p)?T=T.withResumeToken(_e.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,n)),s=s.insert(p,T),C=T,U=f,(0===(x=_).resumeToken.approximateByteSize()||C.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=HT||U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0)&&u.push(t.Pi.updateTargetData(i,T))});let c=Ge(),h=K();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))}),u.push(function fp(r,e,t){let n=K(),s=K();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=Ge();return t.forEach((u,c)=>{const h=i.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(u)),c.isNoDocument()&&c.version.isEqual(G.min())?(e.removeEntry(u,c.readTime),o=o.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(u,c)):k(Iu,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{ks:o,qs:s}})}(i,o,e.documentUpdates).next(f=>{c=f.ks,h=f.qs})),!n.isEqual(G.min())){const f=t.Pi.getLastRemoteSnapshotVersion(i).next(p=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(f)}return b.waitFor(u).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,h)).next(()=>c)}).then(i=>(t.Ms=s,i))}(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(j(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?j(o.hu,14607):s.removedDocuments.size>0&&(j(o.hu,42227),o.hu=!1))}),yield St(t,n,e)}catch(n){yield Ft(n)}})).apply(this,arguments)}function $p(r,e,t){const n=M(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const s=[];n.Tu.forEach((i,o)=>{const u=o.view.va(e);u.snapshot&&s.push(u.snapshot)}),function(o,u){const c=M(o);c.onlineState=u;let h=!1;c.queries.forEach((f,p)=>{for(const _ of p.Sa)_.va(u)&&(h=!0)}),h&&ec(c)}(n.eventManager,e),s.length&&n.Pu.H_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function NE(r,e,t){return fc.apply(this,arguments)}function fc(){return(fc=(0,N.A)(function*(r,e,t){const n=M(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Au.get(e),i=s&&s.key;if(i){let o=new ae(O.comparator);o=o.insert(i,ue.newNoDocument(i,G.min()));const u=K().add(i),c=new Rs(G.min(),new Map,new ae($),o,u);yield zp(n,c),n.du=n.du.remove(i),n.Au.delete(e),Tc(n)}else yield Pr(n.localStore,e,!1).then(()=>kr(n,e,t)).catch(Ft)})).apply(this,arguments)}function kE(r,e){return pc.apply(this,arguments)}function pc(){return(pc=(0,N.A)(function*(r,e){const t=M(r),n=e.batch.batchId;try{const s=yield function QT(r,e){const t=M(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const p=h.batch,_=p.keys();let T=b.resolve();return _.forEach(R=>{T=T.next(()=>f.getEntry(c,R)).next(x=>{const C=h.docVersions.get(R);j(null!==C,48541),x.version.compareTo(C)<0&&(p.applyToRemoteDocument(x,h),x.isValidDocument()&&(x.setReadTime(h.commitVersion),f.addEntry(x)))})}),T.next(()=>u.mutationQueue.removeMutationBatch(c,p))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=K();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}(t.localStore,e);yc(t,n,null),gc(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield St(t,s)}catch(s){yield Ft(s)}})).apply(this,arguments)}function OE(r,e,t){return mc.apply(this,arguments)}function mc(){return(mc=(0,N.A)(function*(r,e,t){const n=M(r);try{const s=yield function(o,u){const c=M(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(p=>(j(null!==p,37113),f=p.keys(),c.mutationQueue.removeMutationBatch(h,p))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);yc(n,e,t),gc(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield St(n,s)}catch(s){yield Ft(s)}})).apply(this,arguments)}function gc(r,e){(r.mu.get(e)||[]).forEach(t=>{t.resolve()}),r.mu.delete(e)}function yc(r,e,t){const n=M(r);let s=n.Vu[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.Vu[n.currentUser.toKey()]=s}}function kr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Iu.get(e))r.Tu.delete(n),t&&r.Pu.yu(n,t);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach(n=>{r.Ru.containsKey(n)||Kp(r,n)})}function Kp(r,e){r.Eu.delete(e.path.canonicalString());const t=r.du.get(e);null!==t&&(Cr(r.remoteStore,t),r.du=r.du.remove(e),r.Au.delete(t),Tc(r))}function Ic(r,e,t){for(const n of t)n instanceof Bp?(r.Ru.addReference(n.key,e),FE(r,n)):n instanceof qp?(k(Yt,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,e),r.Ru.containsKey(n.key)||Kp(r,n.key)):B(19791,{wu:n})}function FE(r,e){const t=e.key,n=t.path.canonicalString();r.du.get(t)||r.Eu.has(n)||(k(Yt,"New document in limbo: "+t),r.Eu.add(n),Tc(r))}function Tc(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const t=new O(H.fromString(e)),n=r.fu.next();r.Au.set(n,new RE(t)),r.du=r.du.insert(t,n),fo(r.remoteStore,new Rt(xe(fr(t.path)),n,"TargetPurposeLimboResolution",Qe.ce))}}function St(r,e,t){return Ec.apply(this,arguments)}function Ec(){return Ec=(0,N.A)(function*(r,e,t){const n=M(r),s=[],i=[],o=[];var u;n.Tu.isEmpty()||(n.Tu.forEach((u,c)=>{o.push(n.pu(c,e,t).then(h=>{if((h||t)&&n.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){s.push(h);const f=yu.As(c.targetId,h);i.push(f)}}))}),yield Promise.all(o),n.Pu.H_(s),yield(u=(0,N.A)(function*(h,f){const p=M(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>b.forEach(f,T=>b.forEach(T.Es,R=>p.persistence.referenceDelegate.addReference(_,T.targetId,R)).next(()=>b.forEach(T.ds,R=>p.persistence.referenceDelegate.removeReference(_,T.targetId,R)))))}catch(_){if(!Lt(_))throw _;k(Iu,"Failed to update sequence numbers: "+_)}for(const _ of f){const T=_.targetId;if(!_.fromCache){const R=p.Ms.get(T),C=R.withLastLimboFreeSnapshotVersion(R.snapshotVersion);p.Ms=p.Ms.insert(T,C)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,i))}),Ec.apply(this,arguments)}function LE(r,e){return Ac.apply(this,arguments)}function Ac(){return(Ac=(0,N.A)(function*(r,e){const t=M(r);if(!t.currentUser.isEqual(e)){k(Yt,"User change. New user:",e.toKey());const n=yield hp(t.localStore,e);t.currentUser=e,(i=t).mu.forEach(u=>{u.forEach(c=>{c.reject(new D(S.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.mu.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield St(t,n.Ls)}var i})).apply(this,arguments)}function UE(r,e){const t=M(r),n=t.Au.get(e);if(n&&n.hu)return K().add(n.key);{let s=K();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const u=t.Tu.get(o);s=s.unionWith(u.view.nu)}return s}}function mo(r){const e=M(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=zp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=UE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=NE.bind(null,e),e.Pu.H_=vE.bind(null,e.eventManager),e.Pu.yu=wE.bind(null,e.eventManager),e}let _o=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,N.A)(function*(){n.serializer=On(t.databaseInfo.databaseId),n.sharedClientState=n.Du(t),n.persistence=n.Cu(t),yield n.persistence.start(),n.localStore=n.vu(t),n.gcScheduler=n.Fu(t,n.localStore),n.indexBackfillerScheduler=n.Mu(t,n.localStore)})()}Fu(t,n){return null}Mu(t,n){return null}vu(t){return function lp(r,e,t,n){return new WT(r,e,t,n)}(this.persistence,new cp,t.initialUser,this.serializer)}Cu(t){return new du(so.mi,this.serializer)}Du(t){return new Ap}terminate(){var t=this;return(0,N.A)(function*(){t.gcScheduler?.stop(),t.indexBackfillerScheduler?.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class xc extends _o{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return j(this.persistence.referenceDelegate instanceof io,46915),new Zf(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?De.withCacheSize(this.cacheSizeBytes):De.DEFAULT;return new du(n=>io.mi(n,t),this.serializer)}}let Or=(()=>{class r{initialize(t,n){var s=this;return(0,N.A)(function*(){s.localStore||(s.localStore=t.localStore,s.sharedClientState=t.sharedClientState,s.datastore=s.createDatastore(n),s.remoteStore=s.createRemoteStore(n),s.eventManager=s.createEventManager(n),s.syncEngine=s.createSyncEngine(n,!t.synchronizeTabs),s.sharedClientState.onlineStateHandler=i=>$p(s.syncEngine,i,1),s.remoteStore.remoteSyncer.handleCredentialChange=LE.bind(null,s.syncEngine),yield Hu(s.remoteStore,s.syncEngine.isPrimaryClient))})()}createEventManager(t){return new AE}createDatastore(t){const n=On(t.databaseInfo.databaseId),s=new sE(t.databaseInfo);return new uE(t.authCredentials,t.appCheckCredentials,s,n)}createRemoteStore(t){return s=this.localStore,i=this.datastore,o=t.asyncQueue,u=n=>$p(this.syncEngine,n,0),c=wp.v()?new wp:new eE,new lE(s,i,o,u,c);var s,i,o,u,c}createSyncEngine(t,n){return function(i,o,u,c,h,f,p){const _=new SE(i,o,u,c,h,f);return p&&(_.gu=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,N.A)(function*(){var n;yield(n=(0,N.A)(function*(i){const o=M(i);k(Mn,"RemoteStore shutting down."),o.Ea.add(5),yield Vr(o),o.Aa.shutdown(),o.Ra.set("Unknown")}),function s(i){return n.apply(this,arguments)})(t.remoteStore),t.datastore?.terminate(),t.eventManager?.terminate()})()}}return r.provider={build:()=>new r},r})();class go{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const Zt="FirestoreClient";class YE{constructor(e,t,n,s,i){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=ve.UNAUTHENTICATED,this.clientId=Ia.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,function(){var u=(0,N.A)(function*(c){k(Zt,"Received user=",c.uid),yield o.authCredentialListener(c),o.user=c});return function(c){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(n,u=>(k(Zt,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new we;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,N.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const s=Nr(n,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Nc(r,e){return kc.apply(this,arguments)}function kc(){return kc=(0,N.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),k(Zt,"Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var s=(0,N.A)(function*(i){n.isEqual(i)||(yield hp(e.localStore,i),n=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),kc.apply(this,arguments)}function Jp(r,e){return Oc.apply(this,arguments)}function Oc(){return(Oc=(0,N.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function Mc(r){return Fc.apply(this,arguments)}(r);k(Zt,"Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Np(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Np(e.remoteStore,s)),r._onlineComponents=e})).apply(this,arguments)}function Fc(){return(Fc=(0,N.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k(Zt,"Using user provided OfflineComponentProvider");try{yield Nc(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(s=e).name?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw e;et("Error using user provided cache. Falling back to memory cache: "+e),yield Nc(r,new _o)}}else k(Zt,"Using default OfflineComponentProvider"),yield Nc(r,new xc(void 0));var s;return r._offlineComponents})).apply(this,arguments)}function yo(r){return Lc.apply(this,arguments)}function Lc(){return(Lc=(0,N.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(k(Zt,"Using user provided OnlineComponentProvider"),yield Jp(r,r._uninitializedComponentsProvider._online)):(k(Zt,"Using default OnlineComponentProvider"),yield Jp(r,new Or))),r._onlineComponents})).apply(this,arguments)}function Fr(r){return Bc.apply(this,arguments)}function Bc(){return(Bc=(0,N.A)(function*(r){const e=yield yo(r),t=e.eventManager;return t.onListen=PE.bind(null,e.syncEngine),t.onUnlisten=CE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=VE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=xE.bind(null,e.syncEngine),t})).apply(this,arguments)}function sm(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const im=new Map,om="firestore.googleapis.com";class um{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new D(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=om,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new D(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function nI(r,e,t,n){if(!0===e&&!0===n)throw new D(S.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=sm(e.experimentalLongPollingOptions??{}),function(n){if(void 0!==n.timeoutSeconds){if(isNaN(n.timeoutSeconds))throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ls{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new um({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new um(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Ky;switch(n.type){case"firstParty":return new Xy(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new D(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,N.A)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=im.get(t);n&&(k("ComponentProvider","Removing Datastore"),im.delete(t),n.terminate())}(this),Promise.resolve()}}class Re{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Re(this.firestore,e,this._query)}}class se{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new se(this.firestore,e,this._key)}toJSON(){return{type:se._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(_n(t,se._jsonSchema))return new se(e,n||null,new O(H.fromString(t.referencePath)))}}se._jsonSchemaVersion="firestore/documentReference/1.0",se._jsonSchema={type:Te("string",se._jsonSchemaVersion),referencePath:Te("string")};class pt extends Re{constructor(e,t,n){super(e,t,fr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new se(this.firestore,null,new O(e))}withConverter(e){return new pt(this.firestore,e,this._path)}}function qc(r,e,...t){if(r=$e(r),1===arguments.length&&(e=Ia.newId()),function va(r,e,t){if(!t)throw new D(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}("doc","path",e),r instanceof Ls){const n=H.fromString(e,...t);return kh(n),new se(r,null,new O(n))}{if(!(r instanceof se||r instanceof pt))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(H.fromString(e,...t));return kh(n),new se(r.firestore,r instanceof pt?r.converter:null,new O(n))}}const lm="AsyncQueue";class hm{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Cu(this,"async_queue_retry"),this._c=()=>{const n=ho();n&&k(lm,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=ho();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ho();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new we;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){var e=this;return(0,N.A)(function*(){if(0!==e.Xu.length){try{yield e.Xu[0](),e.Xu.shift(),e.M_.reset()}catch(t){if(!Lt(t))throw t;k(lm,"Operation failed with retryable error: "+t)}e.Xu.length>0&&e.M_.p_(()=>e.lc())}})()}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(n=>{throw this.nc=n,this.rc=!1,ye("INTERNAL UNHANDLED ERROR: ",dm(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Qu.createAndSchedule(this,e,t,n,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&B(47125,{Pc:dm(this.nc)})}verifyOperationInProgress(){}Tc(){var e=this;return(0,N.A)(function*(){let t;do{t=e.ac,yield t}while(t!==e.ac)})()}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function dm(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+"\n"+r.stack),e}function Lr(r){return function(t){if("object"!=typeof t||null===t)return!1;const s=t;for(const i of["next","error","complete"])if(i in s&&"function"==typeof s[i])return!0;return!1}(r)}class ie extends Ls{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new hm,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){var e=this;return(0,N.A)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new hm(t),e._firestoreClient=void 0,yield t}})()}}function pe(r){if(r._terminated)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||function fm(r){const e=r._freezeSettings(),t=new MI(r._databaseId,r._app?.options.appId||"",r._persistenceKey,(u=e).host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,sm(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator);var u;r._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new YE(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}}(r._componentsProvider))}(r),r._firestoreClient}class Xe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xe(_e.fromBase64String(e))}catch(t){throw new D(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Xe(_e.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Xe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(_n(e,Xe._jsonSchema))return Xe.fromBase64String(e.bytes)}}Xe._jsonSchemaVersion="firestore/bytes/1.0",Xe._jsonSchema={type:Te("string",Xe._jsonSchemaVersion),bytes:Te("string")};class Un{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new D(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ur{constructor(e){this._methodName=e}}class mt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:mt._jsonSchemaVersion}}static fromJSON(e){if(_n(e,mt._jsonSchema))return new mt(e.latitude,e.longitude)}}mt._jsonSchemaVersion="firestore/geoPoint/1.0",mt._jsonSchema={type:Te("string",mt._jsonSchemaVersion),latitude:Te("number"),longitude:Te("number")};class rt{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:rt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(_n(e,rt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>"number"==typeof t))return new rt(e.vectorValues);throw new D(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}rt._jsonSchemaVersion="firestore/vectorValue/1.0",rt._jsonSchema={type:Te("string",rt._jsonSchemaVersion),vectorValues:Te("object")};const mA=/^__.*__$/;class _A{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new bt(e,this.data,this.fieldMask,t,this.fieldTransforms):new yr(e,this.data,t,this.fieldTransforms)}}class _m{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new bt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gm(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B(40011,{Ac:r})}}class Io{constructor(e,t,n,s,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Io({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ao(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(gm(this.Ac)&&mA.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class gA{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||On(e)}Cc(e,t,n,s=!1){return new Io({Ac:e,methodName:t,Dc:n,path:le.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bn(r){const e=r._freezeSettings(),t=On(r._databaseId);return new gA(r._databaseId,!!e.ignoreUndefinedProperties,t)}function To(r,e,t,n,s,i={}){const o=r.Cc(i.merge||i.mergeFields?2:0,e,t,s);Qc("Data must be an object, but it was:",o,n);const u=Tm(n,o);let c,h;if(i.merge)c=new je(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const p of i.mergeFields){const _=qs(e,p,t);if(!o.contains(_))throw new D(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Am(f,_)||f.push(_)}c=new je(f),h=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,h=o.fieldTransforms;return new _A(new Pe(u),c,h)}class Bs extends Ur{_toFieldTransform(e){if(2!==e.Ac)throw e.Sc(1===e.Ac?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Bs}}function qn(r,e){if(Em(r=$e(r)))return Qc("Unsupported field value:",e,r),Tm(r,e);if(r instanceof Ur)return function(n,s){if(!gm(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&4!==e.Ac)throw e.Sc("Nested arrays are not supported");return function(n,s){const i=[];let o=0;for(const u of n){let c=qn(u,s.wc(o));null==c&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,s){if(null===(n=$e(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Hd(s.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const i=te.fromDate(n);return{timestampValue:Tr(s.serializer,i)}}if(n instanceof te){const i=new te(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Tr(s.serializer,i)}}if(n instanceof mt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Xe)return{bytesValue:mf(s.serializer,n._byteString)};if(n instanceof se){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:tu(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof rt)return o=n,u=s,{mapValue:{fields:{[Ma]:{stringValue:Fa},[lr]:{arrayValue:{values:o.toArray().map(h=>{if("number"!=typeof h)throw u.Sc("VectorValues must only contain numeric values.");return Ha(u.serializer,h)})}}}}};var o,u;throw s.Sc(`Unsupported field value: ${Ai(n)}`)}(r,e)}function Tm(r,e){const t={};return ud(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bt(r,(n,s)=>{const i=qn(s,e.mc(n));null!=i&&(t[n]=i)}),{mapValue:{fields:t}}}function Em(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof te||r instanceof mt||r instanceof Xe||r instanceof se||r instanceof Ur||r instanceof rt)}function Qc(r,e,t){if(!Em(t)||!Mh(t)){const n=Ai(t);throw e.Sc("an object"===n?r+" a custom object":r+" "+n)}}function qs(r,e,t){if((e=$e(e))instanceof Un)return e._internalPath;if("string"==typeof e)return Eo(r,e);throw Ao("Field path arguments must be of type string or ",r,!1,void 0,t)}const yA=new RegExp("[~\\*/\\[\\]]");function Eo(r,e,t){if(e.search(yA)>=0)throw Ao(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Un(...e.split("."))._internalPath}catch{throw Ao(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Ao(r,e,t,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${n}`),o&&(c+=` in document ${s}`),c+=")"),new D(S.INVALID_ARGUMENT,u+r+c)}function Am(r,e){return r.some(t=>t.isEqual(e))}class js{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new se(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new IA(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vo("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class IA extends js{data(){return super.data()}}function vo(r,e){return"string"==typeof e?Eo(r,e):e instanceof Un?e._internalPath:e._delegate._internalPath}class Vm{convertValue(e,t="none"){switch(jt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return he(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(At(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Bt(e,(s,i)=>{n[s]=this.convertValue(i,t)}),n}convertVectorValue(e){const t=e.fields?.[lr].arrayValue?.values?.map(n=>he(n.doubleValue));return new rt(t)}convertGeoPoint(e){return new mt(he(e.latitude),he(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ki(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ds(e));default:return null}}convertTimestamp(e){const t=Et(e);return new te(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=H.fromString(e);j(Rf(n),9688,{name:e});const s=new vn(n.get(1),n.get(3)),i=new O(n.popFirst(5));return s.isEqual(t)||ye(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class en{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Je extends js{constructor(e,t,n,s,i,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Po(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(vo("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Je._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle="NOT SUPPORTED",t):t}}Je._jsonSchemaVersion="firestore/documentSnapshot/1.0",Je._jsonSchema={type:Te("string",Je._jsonSchemaVersion),bundleSource:Te("string","DocumentSnapshot"),bundleName:Te("string"),bundle:Te("string")};class Po extends Je{data(e={}){return super.data(e)}}class Ye{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new en(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Po(this._firestore,this._userDataWriter,n.key,n,new en(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(u=>({type:"added",doc:new Po(s._firestore,s._userDataWriter,u.doc.key,u.doc,new en(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:o++}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const c=new Po(s._firestore,s._userDataWriter,u.doc.key,u.doc,new en(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:EA(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ye._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ia.newId();const t=[],n=[],s=[];return this.docs.forEach(i=>{null!==i._document&&(t.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle="NOT SUPPORTED",e}}function EA(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B(61501,{type:r})}}Ye._jsonSchemaVersion="firestore/querySnapshot/1.0",Ye._jsonSchema={type:Te("string",Ye._jsonSchemaVersion),bundleSource:Te("string","QuerySnapshot"),bundleName:Te("string"),bundle:Te("string")};class tn extends Vm{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new se(this.firestore,null,t)}}function Zc(r,...e){r=$e(r);let t={includeMetadataChanges:!1,source:"default"},n=0;"object"!=typeof e[n]||Lr(e[n])||(t=e[n++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Lr(e[n])){const c=e[n];e[n]=c.next?.bind(c),e[n+1]=c.error?.bind(c),e[n+2]=c.complete?.bind(c)}let i,o,u;if(r instanceof se)o=Q(r.firestore,ie),u=fr(r._key.path),i={next:c=>{e[n]&&e[n](function el(r,e,t){const n=t.docs.get(e._key),s=new tn(r);return new Je(r,s,e._key,n,new en(t.hasPendingWrites,t.fromCache),e.converter)}(o,r,c))},error:e[n+1],complete:e[n+2]};else{const c=Q(r,Re);o=Q(c.firestore,ie),u=c._query;const h=new tn(o);i={next:f=>{e[n]&&e[n](new Ye(o,h,c,f))},error:e[n+1],complete:e[n+2]},function vm(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new D(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(r._query)}return function(h,f,p,_){const T=new go(_),R=new nc(f,T,p);return h.asyncQueue.enqueueAndForget((0,N.A)(function*(){return function Xu(r,e){return Ju.apply(this,arguments)}(yield Fr(h),R)})),()=>{T.Nu(),h.asyncQueue.enqueueAndForget((0,N.A)(function*(){return function Yu(r,e){return Zu.apply(this,arguments)}(yield Fr(h),R)}))}}(pe(o),u,s,i)}function $s(r,e){return function(n,s){const i=new we;return n.asyncQueue.enqueueAndForget((0,N.A)(function*(){return function DE(r,e,t){return hc.apply(this,arguments)}(yield function Uc(r){return yo(r).then(e=>e.syncEngine)}(n),s,i)})),i.promise}(pe(r),e)}!function(e,t=!0){Yn="12.0.0",Zr(new Jn("firestore",(n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),u=new ie(new Wy(n.getProvider("auth-internal")),new Jy(o,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new D(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vn(h.options.projectId,f)}(o,s),o);return i={useFetchStreams:t,...i},u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),It(Vh,"4.9.0",e),It(Vh,"4.9.0","esm2020")}();const km="firebasestorage.googleapis.com";class me extends fn{constructor(e,t,n=0){super(nl(e),`Firebase Storage: ${t} (${nl(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,me.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return nl(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.message=this.customData.serverResponse?`${this._baseMessage}\n${this.customData.serverResponse}`:this._baseMessage}}var fe=function(r){return r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment",r}(fe||{});function nl(r){return"storage/"+r}function sl(r){return new me(fe.INVALID_ARGUMENT,r)}function Um(){return new me(fe.APP_DELETED,"The Firebase app was deleted.")}class Le{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Le.makeFromUrl(e,t)}catch{return new Le(e,"")}if(""===n.path)return n;throw function KA(r){return new me(fe.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}(e)}static makeFromUrl(e,t){let n=null;const s="([A-Za-z0-9.\\-_]+)",u=new RegExp("^gs://"+s+"(/(.*))?$","i");function h(z){z.path_=decodeURIComponent(z.path)}const p=t.replace(/[.]/g,"\\."),F=[{regex:u,indices:{bucket:1,path:3},postModify:function i(z){"/"===z.path.charAt(z.path.length-1)&&(z.path_=z.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${p}/v[A-Za-z0-9_]+/b/${s}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:h},{regex:new RegExp(`^https?://${t===km?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${s}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:h}];for(let z=0;z<F.length;z++){const X=F[z],W=X.regex.exec(e);if(W){let g=W[X.indices.path];g||(g=""),n=new Le(W[X.indices.bucket],g),X.postModify(n);break}}if(null==n)throw function $A(r){return new me(fe.INVALID_URL,"Invalid URL '"+r+"'.")}(e);return n}}class YA{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function ol(r,e,t,n){if(n<e)throw sl(`Invalid value for '${r}'. Expected ${e} or greater.`);if(n>t)throw sl(`Invalid value for '${r}'. Expected ${t} or less.`)}var qr=function(r){return r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT",r}(qr||{});class sv{constructor(e,t,n,s,i,o,u,c,h,f,p,_=!0,T=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=u,this.errorCallback_=c,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=p,this.retry=_,this.isUsingEmulator=T,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,x)=>{this.resolve_=R,this.reject_=x,this.start_()})}start_(){const t=(n,s)=>{const i=this.resolve_,o=this.reject_,u=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(u,u.getResponse());!function tv(r){return void 0!==r}(c)?i():i(c)}catch(c){o(c)}else if(null!==u){const c=function rl(){return new me(fe.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}();c.serverResponse=u.getErrorText(),o(this.errorCallback_?this.errorCallback_(u,c):c)}else o(s.canceled?this.appDelete_?Um():function Fm(){return new me(fe.CANCELED,"User canceled the upload/download.")}():function Mm(){return new me(fe.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}())};this.canceled_?t(0,new xo(!1,null,!0)):this.backoffId_=function ZA(r,e,t){let n=1,s=null,i=null,o=!1,u=0;function c(){return 2===u}let h=!1;function f(...C){h||(h=!0,e.apply(null,C))}function p(C){s=setTimeout(()=>{s=null,r(T,c())},C)}function _(){i&&clearTimeout(i)}function T(C,...U){if(h)return void _();if(C)return _(),void f.call(null,C,...U);if(c()||o)return _(),void f.call(null,C,...U);let F;n<64&&(n*=2),1===u?(u=2,F=0):F=1e3*(n+Math.random()),p(F)}let R=!1;function x(C){R||(R=!0,_(),!h&&(null!==s?(C||(u=2),clearTimeout(s),p(0)):C||(u=1)))}return p(0),i=setTimeout(()=>{o=!0,x(!0)},t),x}((n,s)=>{if(s)return void n(!1,new xo(!1,null,!0));const i=this.connectionFactory_();this.pendingConnection_=i;const o=u=>{null!==this.progressCallback_&&this.progressCallback_(u.loaded,u.lengthComputable?u.total:-1)};null!==this.progressCallback_&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const u=i.getErrorCode()===qr.NO_ERROR,c=i.getStatus();if(!u||function jm(r,e){const t=r>=500&&r<600,s=-1!==[408,429].indexOf(r),i=-1!==e.indexOf(r);return t||s||i}(c,this.additionalRetryCodes_)&&this.retry){const f=i.getErrorCode()===qr.ABORT;return void n(!1,new xo(!1,null,f))}const h=-1!==this.successCodes_.indexOf(c);n(!0,new xo(h,i))})},t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function ev(r){r(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class xo{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}class jn{constructor(e,t){this._service=e,this._location=t instanceof Le?t:Le.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new jn(e,t)}get root(){const e=new Le(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function Hm(r){const e=r.lastIndexOf("/",r.length-2);return-1===e?r:r.slice(e+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function yv(r){if(0===r.length)return null;const e=r.lastIndexOf("/");return-1===e?"":r.slice(0,e)}(this._location.path);if(null===e)return null;const t=new Le(this._location.bucket,e);return new jn(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function JA(r){return new me(fe.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function u_(r,e){const t=e?.storageBucket;return null==t?null:Le.makeFromBucketSpec(t,r)}class fl{constructor(e,t,n,s,i,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=km,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=s?Le.makeFromBucketSpec(s,this._host):u_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._bucket=null!=this._url?Le.makeFromBucketSpec(this._url,e):u_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){ol("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){ol("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){var e=this;return(0,N.A)(function*(){if(e._overrideAuthToken)return e._overrideAuthToken;const t=e._authProvider.getImmediate({optional:!0});if(t){const n=yield t.getToken();if(null!==n)return n.accessToken}return null})()}_getAppCheckToken(){var e=this;return(0,N.A)(function*(){if(lh(e.app)&&e.app.settings.appCheckToken)return e.app.settings.appCheckToken;const t=e._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})()}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new jn(this,e)}_makeRequest(e,t,n,s,i=!0){if(this._deleted)return new YA(Um());{const o=function cv(r,e,t,n,s,i,o=!0,u=!1){const c=function qm(r){const e=encodeURIComponent;let t="?";for(const n in r)r.hasOwnProperty(n)&&(t=t+(e(n)+"=")+e(r[n])+"&");return t=t.slice(0,-1),t}(r.urlParams),h=r.url+c,f=Object.assign({},r.headers);return function av(r,e){e&&(r["X-Firebase-GMPID"]=e)}(f,e),function iv(r,e){null!==e&&e.length>0&&(r.Authorization="Firebase "+e)}(f,t),function ov(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}(f,i),function uv(r,e){null!==e&&(r["X-Firebase-AppCheck"]=e)}(f,n),new sv(h,r.method,f,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,s,o,u)}(e,this._appId,n,s,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){var n=this;return(0,N.A)(function*(){const[s,i]=yield Promise.all([n._getAuthToken(),n._getAppCheckToken()]);return n._makeRequest(e,t,s,i).getPromise()})()}}const c_="@firebase/storage",h_="storage";function iw(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),s=r.getProvider("app-check-internal");return new fl(t,n,s,e,"12.0.0")}!function ow(){Zr(new Jn(h_,iw,"PUBLIC").setMultipleInstances(!0)),It(c_,"0.14.0",""),It(c_,"0.14.0","esm2020")}();const d_=ph({apiKey:"AIzaSyBWSYH6aGDBPAiGkNCoX91H5PO1XbSRAWc",authDomain:"shopping-list-e7a70.firebaseapp.com",projectId:"shopping-list-e7a70",storageBucket:"shopping-list-e7a70.firebasestorage.app",messagingSenderId:"229419963479",appId:"YOUR_APP_ID"}),f_=function dA(r,e){const t="object"==typeof r?r:mh(),n="string"==typeof r?r:e||fs,s=ha(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=ql("firestore");i&&function lA(r,e,t,n={}){r=Q(r,Ls);const s=_i(e),i=r._getSettings(),o={...i,emulatorOptions:r._getEmulatorOptions()},u=`${e}:${t}`;s&&(zl(`https://${u}`),Hl("Firestore",!0)),i.host!==om&&i.host!==u&&et("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:u,ssl:s,emulatorOptions:n};if(!Xn(c,o)&&(r._setSettings(c),n.mockUserToken)){let h,f;if("string"==typeof n.mockUserToken)h=n.mockUserToken,f=ve.MOCK_USER;else{h=$l(n.mockUserToken,r._app?.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new D(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new ve(p)}r._authCredentials=new Hy(new Dh(h,f))}}(s,...i)}return s}(d_);!function rw(r=mh(),e){const n=ha(r=$e(r),h_).getImmediate({identifier:e}),s=ql("storage");s&&function sw(r,e,t,n={}){!function nw(r,e,t,n={}){r.host=`${e}:${t}`;const s=_i(e);s&&(zl(`https://${r.host}/b`),Hl("Storage",!0)),r._isUsingEmulator=!0,r._protocol=s?"https":"http";const{mockUserToken:i}=n;i&&(r._overrideAuthToken="string"==typeof i?i:$l(i,r.app.options.projectId))}(r,e,t,n)}(n,...s)}(d_);var uw=Hn(1985),cw=Hn(4438);let lw=(()=>{class r{SCREEN_DOC_ID="widm-screen-state";constructor(){}getScreenState(){return new uw.c(t=>{const n=qc(f_,"screens",this.SCREEN_DOC_ID),s=Zc(n,i=>{if(i.exists())t.next(i.data());else{const o={selectedScreen:null};(function AA(r,e,t){r=Q(r,se);const n=Q(r.firestore,ie),s=function So(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);$s(n,[To(Bn(n),"setDoc",r._key,s,null!==r.converter,t).toMutation(r._key,de.none())])})(n,o),t.next(o)}},i=>{console.error("Firebase error:",i),t.error(i)});return()=>s()})}updateSelectedScreen(t){var n=this;return(0,N.A)(function*(){try{const s=qc(f_,"screens",n.SCREEN_DOC_ID);yield function vA(r,e,t,...n){r=Q(r,se);const s=Q(r.firestore,ie),i=Bn(s);let o;return o="string"==typeof(e=$e(e))||e instanceof Un?function Wc(r,e,t,n,s,i){const o=r.Cc(1,e,t),u=[qs(e,n,t)],c=[s];if(i.length%2!=0)throw new D(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<i.length;_+=2)u.push(qs(e,i[_])),c.push(i[_+1]);const h=[],f=Pe.empty();for(let _=u.length-1;_>=0;--_)if(!Am(h,u[_])){const T=u[_];let R=c[_];R=$e(R);const x=o.yc(T);if(R instanceof Bs)h.push(T);else{const C=qn(R,x);null!=C&&(h.push(T),f.set(T,C))}}const p=new je(h);return new _m(f,p,o.fieldTransforms)}(i,"updateDoc",r._key,e,t,n):function Hc(r,e,t,n){const s=r.Cc(1,e,t);Qc("Data must be an object, but it was:",s,n);const i=[],o=Pe.empty();Bt(n,(c,h)=>{const f=Eo(e,c,t);h=$e(h);const p=s.yc(f);if(h instanceof Bs)i.push(f);else{const _=qn(h,p);null!=_&&(i.push(f),o.set(f,_))}});const u=new je(i);return new _m(o,u,s.fieldTransforms)}(i,"updateDoc",r._key,e),$s(s,[o.toMutation(r._key,de.exists(!0))])}(s,{selectedScreen:t})}catch(s){throw console.error("Error updating selected screen:",s),s}})()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=cw.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()},467:(mg,Yo,Hn)=>{function N(un,Wr,Qr,cn,Wn,ln,hn){try{var dn=un[ln](hn),tt=dn.value}catch(Qn){return void Qr(Qn)}dn.done?Wr(tt):Promise.resolve(tt).then(cn,Wn)}function Zo(un){return function(){var Wr=this,Qr=arguments;return new Promise(function(cn,Wn){var ln=un.apply(Wr,Qr);function hn(tt){N(ln,cn,Wn,hn,dn,"next",tt)}function dn(tt){N(ln,cn,Wn,hn,dn,"throw",tt)}hn(void 0)})}}Hn.d(Yo,{A:()=>Zo})}}]);